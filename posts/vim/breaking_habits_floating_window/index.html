<!DOCTYPE html>
<html lang="en">
<title>Using Neovim floating window to break bad habits - The stuff I do</title>

<meta name="description" content="A personal blog where I write about my side projects">
<meta name="robots" content="index,follow">
<meta name="author" content="statox">

<link rel="canonical" href="https://www.statox.fr/posts/vim/breaking_habits_floating_window/">

<meta property="og:title" content="Using Neovim floating window to break bad habits - The stuff I do">
<meta property="og:type" content="article">

<meta property="og:url" content="https://www.statox.fr/posts/vim/breaking_habits_floating_window/">
<meta property="og:description" content="A personal blog where I write about my side projects">


<meta name="twitter:card" content="summary">

<meta name="twitter:url" content="https://www.statox.fr/posts/vim/breaking_habits_floating_window/">
<meta name="twitter:title" content="Using Neovim floating window to break bad habits - The stuff I do">
<meta name="twitter:description" content="A personal blog where I write about my side projects">



<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Using Neovim floating window to break bad habits</title>
    <meta name="description" content="A personal blog where I write about my side projects">
    <meta name="keywords" content="statox blog">
    <meta property="og:title" content="The stuff I do">
    <meta property="og:url" content="https://www.statox.fr">
    <meta property="og:description" content="A personal blog where I write about my side projects">
    <meta property="og:type" content="website">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/open-fonts@1.1.1/fonts/inter.min.css">

    
    
    <style>
      :root{--nc-font-sans:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--nc-font-mono:Consolas,monaco,'Ubuntu Mono','Liberation Mono','Courier New',Courier,monospace;--nc-tx-1:#000000;--nc-tx-2:#1A1A1A;--nc-bg-1:#FFFFFF;--nc-bg-2:#F6F8FA;--nc-bg-3:#E5E7EB;--nc-lk-1:#0070F3;--nc-lk-2:#0366D6;--nc-lk-tx:#FFFFFF;--nc-ac-1:#79FFE1;--nc-ac-tx:#0C4047;--nc-d-tx-1:#ffffff;--nc-d-tx-2:#eeeeee;--nc-d-bg-1:#000000;--nc-d-bg-2:#111111;--nc-d-bg-3:#222222;--nc-d-lk-1:#3291FF;--nc-d-lk-2:#0070F3;--nc-d-lk-tx:#FFFFFF;--nc-d-ac-1:#7928CA;--nc-d-ac-tx:#FFFFFF}@media (prefers-color-scheme:dark){:root{--nc-tx-1:var(--nc-d-tx-1);--nc-tx-2:var(--nc-d-tx-2);--nc-bg-1:var(--nc-d-bg-1);--nc-bg-2:var(--nc-d-bg-2);--nc-bg-3:var(--nc-d-bg-3);--nc-lk-1:var(--nc-d-lk-1);--nc-lk-2:var(--nc-d-lk-2);--nc-lk-tx:var(--nc-d-lk-tx);--nc-ac-1:var(--nc-d-ac-1);--nc-ac-tx:var(--nc-d-ac-tx)}}*{margin:0;padding:0}address,area,article,aside,audio,blockquote,datalist,details,dl,fieldset,figure,form,iframe,img,input,meter,nav,ol,optgroup,option,output,p,pre,progress,ruby,section,table,textarea,ul,video{margin-bottom:1rem}button,html,input,select{font-family:var(--nc-font-sans)}body{margin:0 auto;max-width:750px;padding:2rem;border-radius:6px;overflow-x:hidden;word-break:break-word;overflow-wrap:break-word;background:var(--nc-bg-1);color:var(--nc-tx-2);font-size:1.03rem;line-height:1.5}::selection{background:var(--nc-ac-1);color:var(--nc-ac-tx)}h1,h2,h3,h4,h5,h6{line-height:1;color:var(--nc-tx-1);padding-top:.875rem}h1,h2,h3{color:var(--nc-tx-1);padding-bottom:2px;margin-bottom:8px;border-bottom:1px solid var(--nc-bg-2)}h4,h5,h6{margin-bottom:.3rem}h1{font-size:2.25rem}h2{font-size:1.85rem}h3{font-size:1.55rem}h4{font-size:1.25rem}h5{font-size:1rem}h6{font-size:.875rem}a{color:var(--nc-lk-1)}a:hover{color:var(--nc-lk-2)}abbr:hover{cursor:help}blockquote{padding:1.5rem;background:var(--nc-bg-2);border-left:5px solid var(--nc-bg-3)}abbr{cursor:help}blockquote :last-child{padding-bottom:0;margin-bottom:0}header{background:var(--nc-bg-2);border-bottom:1px solid var(--nc-bg-3);padding:2rem 1.5rem;margin:-2rem calc(0px - (50vw - 50%)) 2rem;padding-left:calc(50vw - 50%);padding-right:calc(50vw - 50%)}header h1,header h2,header h3{padding-bottom:0;border-bottom:0}header>:first-child{margin-top:0;padding-top:0}header>:last-child{margin-bottom:0}a button,button,input[type=button],input[type=reset],input[type=submit]{font-size:1rem;display:inline-block;padding:6px 12px;text-align:center;text-decoration:none;white-space:nowrap;background:var(--nc-lk-1);color:var(--nc-lk-tx);border:0;border-radius:4px;box-sizing:border-box;cursor:pointer;color:var(--nc-lk-tx)}a button[disabled],button[disabled],input[type=button][disabled],input[type=reset][disabled],input[type=submit][disabled]{cursor:default;opacity:.5;cursor:not-allowed}.button:enabled:hover,.button:focus,button:enabled:hover,button:focus,input[type=button]:enabled:hover,input[type=button]:focus,input[type=reset]:enabled:hover,input[type=reset]:focus,input[type=submit]:enabled:hover,input[type=submit]:focus{background:var(--nc-lk-2)}code,kbd,pre,samp{font-family:var(--nc-font-mono)}code,kbd,pre,samp{background:var(--nc-bg-2);border:1px solid var(--nc-bg-3);border-radius:4px;padding:3px 6px;font-size:.9em}kbd{border-bottom:3px solid var(--nc-bg-3)}pre{padding:1rem 1.4rem;max-width:100%;overflow:auto}pre code{background:inherit;font-size:inherit;color:inherit;border:0;padding:0;margin:0}code pre{display:inline;background:inherit;font-size:inherit;color:inherit;border:0;padding:0;margin:0}details{padding:.6rem 1rem;background:var(--nc-bg-2);border:1px solid var(--nc-bg-3);border-radius:4px}summary{cursor:pointer;font-weight:700}details[open]{padding-bottom:.75rem}details[open] summary{margin-bottom:6px}details[open]>:last-child{margin-bottom:0}dt{font-weight:700}dd::before{content:'→ '}hr{border:0;border-bottom:1px solid var(--nc-bg-3);margin:1rem auto}fieldset{margin-top:1rem;padding:2rem;border:1px solid var(--nc-bg-3);border-radius:4px}legend{padding:auto .5rem}table{border-collapse:collapse;width:100%}td,th{border:1px solid var(--nc-bg-3);text-align:left;padding:.5rem}th{background:var(--nc-bg-2)}tr:nth-child(even){background:var(--nc-bg-2)}table caption{font-weight:700;margin-bottom:.5rem}textarea{max-width:100%}ol,ul{padding-left:2rem}li{margin-top:.4rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}mark{padding:3px 6px;background:var(--nc-ac-1);color:var(--nc-ac-tx)}input,select,textarea{padding:6px 12px;margin-bottom:.5rem;background:var(--nc-bg-2);color:var(--nc-tx-2);border:1px solid var(--nc-bg-3);border-radius:4px;box-shadow:none;box-sizing:border-box}img{max-width:100%}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.post-subheader{font-style:italic;color:#80837c}.post-date{font-family:var(--nc-font-mono)}@media screen and (max-width:600px){.post-date{display:none}}.note-tags{font-family:var(--nc-font-mono);opacity:.6}.not-found{text-align:center}#not-found-canvas{z-index:-1}a{text-decoration:none}pre{max-height:50rem}img{display:block;margin-left:auto;margin-right:auto}ul{list-style-type:circle}:root{--nc-tx-1:#546e7a;--nc-tx-2:#161d21;--nc-bg-1:#F4F4F4;--nc-bg-2:#eae8e8;--nc-bg-3:#FAFAFA;--nc-lk-1:#39ADB5;--nc-lk-2:#528aff;--nc-lk-tx:#F3F4F5;--nc-ac-1:#91B859;--nc-ac-tx:#FAFAFA;--nc-d-tx-1:#FFFFFF;--nc-d-tx-2:#B7B7B7;--nc-d-bg-1:#1E272C;--nc-d-bg-2:#161d21;--nc-d-bg-3:#263238;--nc-d-lk-1:#5E92FF;--nc-d-lk-2:#528aff;--nc-d-lk-tx:#2E3C43;--nc-d-ac-1:#C3E88D;--nc-d-ac-tx:#263238}@media (prefers-color-scheme:dark){:root{--nc-tx-1:var(--nc-d-tx-1);--nc-tx-2:var(--nc-d-tx-2);--nc-bg-1:var(--nc-d-bg-1);--nc-bg-2:var(--nc-d-bg-2);--nc-bg-3:var(--nc-d-bg-3);--nc-lk-1:var(--nc-d-lk-1);--nc-lk-2:var(--nc-d-lk-2);--nc-lk-tx:var(--nc-d-lk-tx);--nc-ac-1:var(--nc-d-ac-1);--nc-ac-tx:var(--nc-d-ac-tx)}}.nav-link{text-decoration:none}.nav-link.active{color:var(--nc-lk-2)}.hamburger{width:20px;height:2px;box-shadow:inset 0 0 0 32px,0 -6px,0 6px;margin:16px 7px;display:block}.topnav .icon{display:none}@media screen and (max-width:600px){.topnav span.nav-item:not(.active){display:none}.topnav span.icon{float:right;display:block;right:0;top:0;color:var(--nc-lk-1)}}@media screen and (max-width:600px){.topnav .nav-separator{display:none}}@media screen and (max-width:600px){.topnav.responsive{position:relative}.topnav.responsive span.icon{position:absolute;right:0;top:0;color:var(--nc-lk-2)}.topnav.responsive span{float:none;display:block;text-align:left}.topnav.responsive span.nav-item:not(.active){display:block}}.comment{--comment-bg:#e3efee;--comment-d-bg:#2a4765;margin-top:20px;padding:5px}.add-comment-btn{float:right}.comment-header{background:var(--comment-bg);padding-right:100px;padding-left:10px;border-top-left-radius:10px;border-top-right-radius:10px;padding:5px}.comment-content{border:2px solid var(--comment-bg);border-bottom-left-radius:10px;border-bottom-right-radius:10px}.comment-text{padding:10px}.comment-reactions{border-top:2px solid var(--comment-bg);padding:5px}.comment-reaction-item{padding-right:10px;padding-left:10px;border-right:2px solid var(--comment-bg)}@media (prefers-color-scheme:dark){.comment{--comment-bg:var(--comment-d-bg)}}kbd{--black-800:#242729;--white:#fff;--black-075:#e4e6e8;--black-300:#9fa6ad;--s-prose-line-height:1.5;--ff-sans:Arial,"Helvetica Neue",Helvetica,sans-serif}@media (prefers-color-scheme:dark){kbd{--black-800:#e7e8eb;--white:#2d2d2d;--black-075:#404345;--black-300:#7d848d}}kbd{display:inline-block;margin:0 .1em;padding:.1em .6em;font-family:var(--nc-font-sans);font-size:11px;line-height:var(--s-prose-line-height);color:var(--black-800);text-shadow:0 1px 0 var(--white);background-color:var(--black-075);border:1px solid var(--black-300);border-radius:3px;box-shadow:0 1px 1px rgba(12,13,14,.15),inset 0 1px 0 0 #fff;overflow-wrap:break-word}
    </style>

    
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">

    <script>
        function navbarToggle() {
            var x = document.getElementById("header-navbar");
            if (x.className === "topnav") {
                x.className += " responsive";
            } else {
                x.className = "topnav";
            }
        }
    </script>
</head>
<body>
    <header>
        <h1>The stuff I do</h1>
        <!--
           - Make the whole navbar clickable: It doesn't change anything on desktop
           - and makes it easier to open the menu on mobile
           -->
        <nav class="topnav" id="header-navbar" onclick="navbarToggle()">
            
            
            

            
                
                
                
                
                <span class="nav-item ">
                    <a class="nav-link " href="/">Home</a>
                    <i class="nav-separator"> ♢ </i>
                </span>
                
                
                
                
                
                <span class="nav-item ">
                    <a class="nav-link " href="/coolcovers/">Cool covers</a>
                    <i class="nav-separator"> ♢ </i>
                </span>
                
                
                
                
                
                <span class="nav-item ">
                    <a class="nav-link " href="/notes/">Notes</a>
                    <i class="nav-separator"> ♢ </i>
                </span>
                
                
                
                
                
                <span class="nav-item ">
                    <a class="nav-link " href="/about/">About</a>
                    <i class="nav-separator"> ♢ </i>
                </span>
                
                
                
                
                
                <span class="nav-item ">
                    <a class="nav-link " href="/social/">Social</a>
                    <i class="nav-separator"> ♢ </i>
                </span>
                
                
                
                
                
                <span class="nav-item ">
                    <a class="nav-link " href="/ring/">Ring</a>
                    <i class="nav-separator"> ♢ </i>
                </span>
                
                
                
                
                
                <span class="nav-item ">
                    <a class="nav-link " href="/feed.xml">RSS</a>
                    <i class="nav-separator"></i>
                </span>
                

                
                <span class="icon hamburger" onclick="navbarToggle()"> </span>
        </nav>
    </header>

    

    <div class="content-container">
        
<h2>Using Neovim floating window to break bad habits</h2>
<p class="post-subheader">
    March 7, 2021
    - 2201 words
    - <span id="commentCounter"></span> comments

</p>
<p><a href="/">← Posts</a></p>

<p>In 2016 I added to my <code>.vimrc</code> a mapping to get easier access to window commands in normal mode. I was pretty happy with it in my local setup but it broke my workflow when I edited files on remote servers. Over time this got pestering enough for me to take action and decide to solve the issue. I thought it was a good opportunity to experiment with Neovim <a href="https://neovim.io/doc/user/api.html#api-floatwin" target="_blank" rel="noopener noreferrer">floating windows</a>.</p>
<p>In this article I'll show how I used some of the Neovim features to create a quick way to get rid of my bad habits. If you never used the floating window it should be an introduction to get started with this feature and give you some inspiration to use it for your own needs.</p>
<h3>The problem</h3>
<p>The problematic mapping I added to my <code>.vimrc</code> is the following:</p>
<pre class="language-vim"><code class="language-vim"><span class="token comment">" Use s instead of &lt;C-w> to handle windows</span><br>nnoremap s <span class="token operator">&lt;</span>C<span class="token operator">-</span><span class="token keyword">w</span><span class="token operator">></span></code></pre>
<p>This remaps <code>s</code> in normal mode to <code>&lt;C-w&gt;</code> which is the default mapping to access window commands. For example instead of using <kbd>ctrl+w</kbd><kbd>v</kbd> and <kbd>ctrl+w</kbd><kbd>s</kbd> to create splits or <kbd>ctrl+w</kbd><kbd>o</kbd> to focus the current split I can use respectively <kbd>s</kbd><kbd>v</kbd>, <kbd>s</kbd><kbd>s</kbd> and <kbd>s</kbd><kbd>o</kbd> (See <a href="http://vimhelp.appspot.com/index.txt.html#CTRL-W" target="_blank" rel="noopener noreferrer"><code>:h CTRL-W</code></a> for the complete list of window commands if you are not familiar with them). This feels more comfortable to use a single key rather than pressing a key chord.</p>
<p>The issue with this mapping is that <code>s</code> is a built-in Vim command, <a href="http://vimhelp.appspot.com/change.txt.html#s" target="_blank" rel="noopener noreferrer"><code>:h s</code></a> says:</p>
<pre><code>[&quot;x]s   Delete [count] characters [into register x] and start
        insert (s stands for Substitute).  Synonym for &quot;cl&quot;
        (not linewise).
</code></pre>
<p>I've never found a use case where this is actually helpful (as the doc says <code>cl</code> does almost the same thing) so remapping it didn't really affect my productivity. However when I edit files on remote severs where I haven't uploaded my config my muscle memory makes me press <kbd>s</kbd> and I end up editing the current buffer instead of manipulating my windows which is irritating.</p>
<p>When I decided to get rid of this nasty habit I removed the mapping from my <code>.vimrc</code> but I also needed something to annoy me out of using it. An easy solution would have been to remap the key to <a href="https://neovim.io/doc/user/intro.html#%3cNop%3e" target="_blank" rel="noopener noreferrer"><code>&lt;Nop&gt;</code></a> so that it does nothing but then the command silently fails and I end up executing the second part of the command (<code>v</code>, <code>s</code>, <code>o</code>...) which is not ideal for my workflow. That's when the floating window comes useful. I wanted to have a very visible warning saying that I used a command I shouldn't have and that I should try again with the right command.</p>
<h3>Specifying the solution</h3>
<p>Here is the solution I came up with:</p>
<p><img src="../../../images/vim_breaking_habits/floating_window_notice.png" alt="Floating window notice"></p>
<p>This floating window is shown when I press a command I want to avoid. There are a few features I wanted to have in this solution:</p>
<ul>
<li>The window is spawned in the middle of Neovim UI so that I can't miss it;</li>
<li>The borders of the window are delimited with ascii characters to make it more visible;</li>
<li>It should be easy to close the window both with regular commands (like <code>:close</code>) and with specific keys like <kbd>Escape</kbd>, <kbd>Enter</kbd> or <kbd>Space</kbd> (which is my leader key);</li>
<li>I should have a convenient command to &quot;disable&quot; several normal mode commands with this window;</li>
<li>The message shown in the window should be multi-lines, centered and configurable depending on the disabled command.</li>
</ul>
<h3>Implementing the solution</h3>
<h4>Spawning a floating window</h4>
<p>The first step get to this solution is to create a function spawning a new floating window:</p>
<pre class="language-vim"><code class="language-vim"><span class="token keyword">function</span><span class="token operator">!</span> <span class="token function">BreakHabitsWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> abort<br>    <span class="token comment">" Define the size of the floating window</span><br>    <span class="token keyword">let</span> width <span class="token operator">=</span> <span class="token number">50</span><br>    <span class="token keyword">let</span> height <span class="token operator">=</span> <span class="token number">10</span><br><br>    <span class="token comment">" Create the scratch buffer displayed in the floating window</span><br>    <span class="token keyword">let</span> buf <span class="token operator">=</span> <span class="token function">nvim_create_buf</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span>false<span class="token punctuation">,</span> v<span class="token punctuation">:</span>true<span class="token punctuation">)</span><br><br>    <span class="token comment">" Get the current UI</span><br>    <span class="token keyword">let</span> ui <span class="token operator">=</span> <span class="token function">nvim_list_uis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><br><br>    <span class="token comment">" Create the floating window</span><br>    <span class="token keyword">let</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'relative'</span><span class="token punctuation">:</span> <span class="token string">'editor'</span><span class="token punctuation">,</span><br>                \ <span class="token string">'width'</span><span class="token punctuation">:</span> width<span class="token punctuation">,</span><br>                \ <span class="token string">'height'</span><span class="token punctuation">:</span> height<span class="token punctuation">,</span><br>                \ <span class="token string">'col'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>ui<span class="token operator">.</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                \ <span class="token string">'row'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>ui<span class="token operator">.</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                \ <span class="token string">'anchor'</span><span class="token punctuation">:</span> <span class="token string">'NW'</span><span class="token punctuation">,</span><br>                \ <span class="token string">'style'</span><span class="token punctuation">:</span> <span class="token string">'minimal'</span><span class="token punctuation">,</span><br>                \ <span class="token punctuation">}</span><br>    <span class="token keyword">let</span> <span class="token keyword">win</span> <span class="token operator">=</span> <span class="token function">nvim_open_win</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span><br><span class="token keyword">endfunction</span></code></pre>
<p>We begin by creating the buffer which will be shown in the floating window. Neovim provides the <a href="https://neovim.io/doc/user/api.html#nvim_create_buf%28%29" target="_blank" rel="noopener noreferrer"><code>nvim_create_buf()</code></a> function to create an unlisted buffer and return its reference.</p>
<p>We then need to call <a href="https://neovim.io/doc/user/api.html#nvim_list_uis%28%29" target="_blank" rel="noopener noreferrer"><code>nvim_list_uis()</code></a> to get the currently attached UIs. In my case I only have one UI (the Neovim instance open in my terminal) so I can directly use the first item of the returned list, there are probably some cases where one would want to be more thoughtful about the way to get this info but for now I want to keep things simple. We will then use <code>ui.width</code> and <code>ui.height</code> to get its dimensions.</p>
<p>Finally we can use <code>nvim_open_win()</code> to open the floating window. The function takes three arguments:</p>
<ul>
<li>The handle of the buffer we previously created and which will be used in the window.</li>
<li>A boolean specifying if the window should be focused immediately after its creation. Here we set it to <code>v:true</code> because we want the window to be focused to close it easily.</li>
<li>A map defining the window configuration. <a href="https://neovim.io/doc/user/api.html#nvim_open_win%28%29" target="_blank" rel="noopener noreferrer">The doc</a> describes all the available options. Here we especially make use of <code>width</code> and <code>height</code> to define the size of the window and <code>anchor</code>, <code>col</code> and <code>row</code> to define where on the screen we will place it.</li>
</ul>
<p>Calling this function with <code>:call BreakHabitsWindow()</code> will spawn a simple empty floating window:</p>
<p><img src="../../../images/vim_breaking_habits/simple_floating_window.png" alt="Simple floating window"></p>
<h4>Showing the window borders</h4>
<p>My second requirement is to have a box drawn in the buffer to show the borders of the window. There are a lot of different ways to achieve this but Neovim provides a convenient <a href="https://neovim.io/doc/user/api.html#nvim_buf_set_lines%28%29" target="_blank" rel="noopener noreferrer"><code>nvim_buf_set_lines()</code></a> function to set the content of a buffer.</p>
<p>We start by creating the strings to use as the first and last lines and as the ones in between thanks to <a href="http://vimhelp.appspot.com/eval.txt.html#repeat%28%29" target="_blank" rel="noopener noreferrer"><code>repeat()</code></a> and put them in a list:</p>
<pre class="language-vim"><code class="language-vim"><span class="token comment">" create the lines to draw a box</span><br><span class="token keyword">let</span> horizontal_border <span class="token operator">=</span> <span class="token string">'+'</span> <span class="token operator">.</span> <span class="token function">repeat</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span> width <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string">'+'</span><br><span class="token keyword">let</span> empty_line <span class="token operator">=</span> <span class="token string">'|'</span> <span class="token operator">.</span> <span class="token function">repeat</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> width <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string">'|'</span><br><span class="token keyword">let</span> <span class="token builtin">lines</span> <span class="token operator">=</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">[</span>horizontal_border<span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token function">range</span><span class="token punctuation">(</span>height<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'empty_line'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> horizontal_border<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<p>We can then use this list with <code>nvim_buf_set_lines()</code>:</p>
<pre class="language-vim"><code class="language-vim"><span class="token comment">" set the box in the buffer</span><br><span class="token keyword">call</span> <span class="token function">nvim_buf_set_lines</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> v<span class="token punctuation">:</span>false<span class="token punctuation">,</span> <span class="token builtin">lines</span><span class="token punctuation">)</span></code></pre>
<p>Adding that to our <code>BreakHabitsWindow()</code> function we get the following result:</p>
<p><img src="../../../images/vim_breaking_habits/box_floating_window.png" alt="Floating window with a box"></p>
<h4>Adding a message in the window</h4>
<p>Next step is to show a message in the window. To do that we will add a parameter to the <code>BreakHabitsWindow()</code>. As we want multi-lines messages this parameter will be a list of strings with each item being a line.</p>
<pre class="language-vim"><code class="language-vim"><span class="token comment">" Add a parameter which can then be accessed with a:message</span><br><span class="token keyword">function</span><span class="token operator">!</span> <span class="token function">BreakHabitsWindow</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> abort</code></pre>
<p>To add this message in the window we will use <a href="https://neovim.io/doc/user/api.html#nvim_buf_set_text%28%29" target="_blank" rel="noopener noreferrer"><code>nvim_buf_set_text()</code></a>, as the doc says this function is preferred to <code>nvim_buf_set_lines()</code> when only modifying parts of a line.</p>
<p>The function takes as parameters a buffer reference, the position of the text to replace (<code>start_row</code>, <code>start_col</code>, <code>end_row</code> and <code>end_col</code>) as well as the text to use. So we loop over each lines of the message, compute the position and put it in the buffer:</p>
<pre class="language-vim"><code class="language-vim"><span class="token comment">" Create the lines for the centered message and put them in the buffer</span><br><span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">0</span><br><span class="token keyword">for</span> line <span class="token keyword">in</span> a<span class="token punctuation">:</span>message<br>    <span class="token keyword">let</span> start_col <span class="token operator">=</span> <span class="token punctuation">(</span>width <span class="token operator">-</span> <span class="token function">len</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><br>    <span class="token keyword">let</span> end_col <span class="token operator">=</span> start_col <span class="token operator">+</span> <span class="token function">len</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><br>    <span class="token keyword">let</span> current_row <span class="token operator">=</span> height<span class="token operator">/</span><span class="token number">2</span><span class="token operator">-</span><span class="token function">len</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span>message<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span> <span class="token operator">+</span> offset<br>    <span class="token keyword">let</span> offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token number">1</span><br>    <span class="token keyword">call</span> <span class="token function">nvim_buf_set_text</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> current_row<span class="token punctuation">,</span> start_col<span class="token punctuation">,</span> current_row<span class="token punctuation">,</span> end_col<span class="token punctuation">,</span> <span class="token punctuation">[</span>line<span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token keyword">endfor</span></code></pre>
<p>We can now call the function with the right parameter <code>:call BreakHabitsWindow([&quot;Hello world&quot;, &quot;This is our floating message&quot;])</code> and here we have a message in the window:</p>
<p><img src="../../../images/vim_breaking_habits/message_floating_window.png" alt="Floating window with a message"></p>
<h4>Closing the window</h4>
<p>Once the window is spawned I want to be able to close it easily. Using <a href="https://neovim.io/doc/user/windows.html#%3aclose" target="_blank" rel="noopener noreferrer"><code>:close</code></a> is an option but I want something faster and it is the opportunity to explore <a href="https://neovim.io/doc/user/api.html#nvim_buf_set_keymap%28%29" target="_blank" rel="noopener noreferrer"><code>nvim_buf_set_keymap()</code></a>. This function allows to set buffer-local mappings. Let's define our closing keys and make them call <code>:close</code>:</p>
<pre class="language-vim"><code class="language-vim"><span class="token comment">" Set mappings in the buffer to close the window easily</span><br><span class="token keyword">let</span> closingKeys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'&lt;Esc>'</span><span class="token punctuation">,</span> <span class="token string">'&lt;CR>'</span><span class="token punctuation">,</span> <span class="token string">'&lt;Leader>'</span><span class="token punctuation">]</span><br><span class="token keyword">for</span> closingKey <span class="token keyword">in</span> closingKeys<br>    <span class="token keyword">call</span> <span class="token function">nvim_buf_set_keymap</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">'n'</span><span class="token punctuation">,</span> closingKey<span class="token punctuation">,</span> <span class="token string">':close&lt;CR>'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'silent'</span><span class="token punctuation">:</span> v<span class="token punctuation">:</span>true<span class="token punctuation">,</span> <span class="token string">'nowait'</span><span class="token punctuation">:</span> v<span class="token punctuation">:</span>true<span class="token punctuation">,</span> <span class="token string">'noremap'</span><span class="token punctuation">:</span> v<span class="token punctuation">:</span>true<span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token keyword">endfor</span></code></pre>
<p>The parameters are as follow:</p>
<ul>
<li>The buffer handle which we already used in the <code>nvim_open_win()</code>;</li>
<li>The mode of the mapping, here we use <code>n</code> for normal mode mappings (this is the equivalent of using <a href="http://vimhelp.appspot.com/map.txt.html#%3Anmap" target="_blank" rel="noopener noreferrer"><code>nmap</code></a>);</li>
<li>The <code>closingKey</code> variable holds the left hand side of the mapping;</li>
<li>The 4th parameter is the right hand side of the mapping;</li>
<li>And finally we give the mapping options in a map:
<ul>
<li><code>silent</code> to avoid showing the command used,</li>
<li><code>nowait</code> to avoid waiting for follow up keys in the mapping</li>
<li>and <code>noremap</code> to create a non recursive mapping.<br>
If you are not familiar with these options see <a href="https://neovim.io/doc/user/map.html#%3amap-arguments" target="_blank" rel="noopener noreferrer"><code>:h :map-arguments</code></a>.</li>
</ul>
</li>
</ul>
<p>With this added to <code>BreakHabitsWindow()</code> we can now close the window quickly with our defined keys.</p>
<h4>Adding some color</h4>
<p>We can finally add a last touch to improve our UI, using <a href="https://neovim.io/doc/user/api.html#nvim_win_set_option%28%29" target="_blank" rel="noopener noreferrer"><code>nvim_win_set_option()</code></a> we can define a different highlighting group for the <code>Normal</code> highlighting group to change how the text is displayed. I went with <code>ErrorFloat</code> because I liked how it looks but it is possible that this highlighting group is not defined on your setup. You can use <a href="https://neovim.io/doc/user/syntax.html#%3ahighlight" target="_blank" rel="noopener noreferrer"><code>:highlight</code></a> to list the groups available to you, and check <a href="https://neovim.io/doc/user/options.html#%27winhl%27" target="_blank" rel="noopener noreferrer"><code>:h 'winhl'</code></a> for more details about highlighting:</p>
<pre class="language-vim"><code class="language-vim"><span class="token comment">" Change highlighting</span><br><span class="token keyword">call</span> <span class="token function">nvim_win_set_option</span><span class="token punctuation">(</span><span class="token keyword">win</span><span class="token punctuation">,</span> <span class="token string">'winhl'</span><span class="token punctuation">,</span> <span class="token string">'Normal:ErrorFloat'</span><span class="token punctuation">)</span></code></pre>
<p>And here we are:</p>
<p><img src="../../../images/vim_breaking_habits/colors_floating_window.png" alt="Floating window with a colored message"></p>
<h4>Creating the mappings</h4>
<p>Now that we have a function which spawns the window as we want it the last thing to do is to remap the commands triggering our function. I wanted an easy way to create several mappings with different messages. We can do that with a simple function:</p>
<pre class="language-vim"><code class="language-vim"><span class="token keyword">function</span><span class="token operator">!</span> breakhabits#<span class="token function">createmappings</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> message<span class="token punctuation">)</span> abort<br>    <span class="token keyword">for</span> <span class="token builtin">key</span> <span class="token keyword">in</span> a<span class="token punctuation">:</span>keys<br>        <span class="token keyword">call</span> <span class="token function">nvim_set_keymap</span><span class="token punctuation">(</span><span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token builtin">key</span><span class="token punctuation">,</span> <span class="token string">':call BreakHabitsWindow('</span> <span class="token operator">.</span> <span class="token function">string</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span>message<span class="token punctuation">)</span><span class="token operator">.</span> <span class="token string">')&lt;CR>'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'silent'</span><span class="token punctuation">:</span> v<span class="token punctuation">:</span>true<span class="token punctuation">,</span> <span class="token string">'nowait'</span><span class="token punctuation">:</span> v<span class="token punctuation">:</span>true<span class="token punctuation">,</span> <span class="token string">'noremap'</span><span class="token punctuation">:</span> v<span class="token punctuation">:</span>true<span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token keyword">endfor</span><br><span class="token keyword">endfunction</span></code></pre>
<p>This makes use of the <a href="https://neovim.io/doc/user/api.html#nvim_set_keymap%28%29" target="_blank" rel="noopener noreferrer"><code>:h nvim_set_keymap()</code></a> which works like <code>nvim_buf_set_keymap()</code> but to create global mappings rather than buffer-local ones.</p>
<p><em>There is one caveat with this method: As the <code>message</code> list is stringified, there might be some escaping issues (for example using <code>&quot;&lt;C-w&gt;&quot;</code> in one of the string breaks the function). There is probably a workaround for that, maybe using <a href="https://neovim.io/doc/user/eval.html#funcref%28%29" target="_blank" rel="noopener noreferrer"><code>:h funcref()</code></a> but I still have to work on that.</em></p>
<p>Let's use the <a href="https://neovim.io/doc/user/eval.html#autoload" target="_blank" rel="noopener noreferrer"><code>autoload</code></a> feature by moving the code to <code>~/.vim/autoload/breakhabits.vim</code> and then we can call it from our <code>.vimrc</code> like this:</p>
<pre class="language-vim"><code class="language-vim"><span class="token keyword">let</span> windowHabitsKeys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"s="</span><span class="token punctuation">,</span> <span class="token string">"sv"</span><span class="token punctuation">,</span> <span class="token string">"ss"</span><span class="token punctuation">,</span> <span class="token string">"so"</span><span class="token punctuation">,</span> <span class="token string">"sw"</span><span class="token punctuation">,</span> <span class="token string">"sh"</span><span class="token punctuation">,</span> <span class="token string">"sj"</span><span class="token punctuation">,</span> <span class="token string">"sk"</span><span class="token punctuation">,</span> <span class="token string">"sl"</span><span class="token punctuation">,</span> <span class="token string">"s&lt;S-h>"</span><span class="token punctuation">,</span> <span class="token string">"s&lt;S-j>"</span><span class="token punctuation">,</span> <span class="token string">"s&lt;S-k>"</span><span class="token punctuation">,</span> <span class="token string">"s&lt;S-l>"</span><span class="token punctuation">,</span> <span class="token string">"s&lt;"</span><span class="token punctuation">,</span> <span class="token string">"s>"</span><span class="token punctuation">,</span> <span class="token string">"sc"</span><span class="token punctuation">]</span><br><span class="token keyword">let</span> windowHabitsMessage <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"USE &lt; C-W > INSTEAD"</span><span class="token punctuation">,</span> <span class="token string">"BREAK BAD HABITS"</span><span class="token punctuation">]</span><br><span class="token keyword">call</span> breakhabits#<span class="token function">createmappings</span><span class="token punctuation">(</span>windowHabitsKeys<span class="token punctuation">,</span> windowHabitsMessage<span class="token punctuation">)</span></code></pre>
<p>And here we have a finished solution. So far I have been pretty contented with how it works and I'm already fixing my muscle memory, which was my goal! Here is the complete code:</p>
<pre class="language-vim"><code class="language-vim"><span class="token keyword">function</span><span class="token operator">!</span> breakhabits#<span class="token function">createmappings</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> message<span class="token punctuation">)</span> abort<br>    <span class="token keyword">for</span> <span class="token builtin">key</span> <span class="token keyword">in</span> a<span class="token punctuation">:</span>keys<br>        <span class="token keyword">call</span> <span class="token function">nvim_set_keymap</span><span class="token punctuation">(</span><span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token builtin">key</span><span class="token punctuation">,</span> <span class="token string">':call BreakHabitsWindow('</span> <span class="token operator">.</span> <span class="token function">string</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span>message<span class="token punctuation">)</span><span class="token operator">.</span> <span class="token string">')&lt;CR>'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'silent'</span><span class="token punctuation">:</span> v<span class="token punctuation">:</span>true<span class="token punctuation">,</span> <span class="token string">'nowait'</span><span class="token punctuation">:</span> v<span class="token punctuation">:</span>true<span class="token punctuation">,</span> <span class="token string">'noremap'</span><span class="token punctuation">:</span> v<span class="token punctuation">:</span>true<span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token keyword">endfor</span><br><span class="token keyword">endfunction</span><br><br><span class="token keyword">function</span><span class="token operator">!</span> <span class="token function">BreakHabitsWindow</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> abort<br>    <span class="token comment">" Define the size of the floating window</span><br>    <span class="token keyword">let</span> width <span class="token operator">=</span> <span class="token number">50</span><br>    <span class="token keyword">let</span> height <span class="token operator">=</span> <span class="token number">10</span><br><br>    <span class="token comment">" Create the scratch buffer displayed in the floating window</span><br>    <span class="token keyword">let</span> buf <span class="token operator">=</span> <span class="token function">nvim_create_buf</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span>false<span class="token punctuation">,</span> v<span class="token punctuation">:</span>true<span class="token punctuation">)</span><br><br>    <span class="token comment">" create the lines to draw a box</span><br>    <span class="token keyword">let</span> horizontal_border <span class="token operator">=</span> <span class="token string">'+'</span> <span class="token operator">.</span> <span class="token function">repeat</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span> width <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string">'+'</span><br>    <span class="token keyword">let</span> empty_line <span class="token operator">=</span> <span class="token string">'|'</span> <span class="token operator">.</span> <span class="token function">repeat</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> width <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string">'|'</span><br>    <span class="token keyword">let</span> <span class="token builtin">lines</span> <span class="token operator">=</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">[</span>horizontal_border<span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token function">range</span><span class="token punctuation">(</span>height<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'empty_line'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> horizontal_border<span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token comment">" set the box in the buffer</span><br>    <span class="token keyword">call</span> <span class="token function">nvim_buf_set_lines</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> v<span class="token punctuation">:</span>false<span class="token punctuation">,</span> <span class="token builtin">lines</span><span class="token punctuation">)</span><br><br>    <span class="token comment">" Create the lines for the centered message and put them in the buffer</span><br>    <span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">0</span><br>    <span class="token keyword">for</span> line <span class="token keyword">in</span> a<span class="token punctuation">:</span>message<br>        <span class="token keyword">let</span> start_col <span class="token operator">=</span> <span class="token punctuation">(</span>width <span class="token operator">-</span> <span class="token function">len</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><br>        <span class="token keyword">let</span> end_col <span class="token operator">=</span> start_col <span class="token operator">+</span> <span class="token function">len</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><br>        <span class="token keyword">let</span> current_row <span class="token operator">=</span> height<span class="token operator">/</span><span class="token number">2</span><span class="token operator">-</span><span class="token function">len</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span>message<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span> <span class="token operator">+</span> offset<br>        <span class="token keyword">let</span> offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token number">1</span><br>        <span class="token keyword">call</span> <span class="token function">nvim_buf_set_text</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> current_row<span class="token punctuation">,</span> start_col<span class="token punctuation">,</span> current_row<span class="token punctuation">,</span> end_col<span class="token punctuation">,</span> <span class="token punctuation">[</span>line<span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token keyword">endfor</span><br><br>    <span class="token comment">" Set mappings in the buffer to close the window easily</span><br>    <span class="token keyword">let</span> closingKeys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'&lt;Esc>'</span><span class="token punctuation">,</span> <span class="token string">'&lt;CR>'</span><span class="token punctuation">,</span> <span class="token string">'&lt;Leader>'</span><span class="token punctuation">]</span><br>    <span class="token keyword">for</span> closingKey <span class="token keyword">in</span> closingKeys<br>        <span class="token keyword">call</span> <span class="token function">nvim_buf_set_keymap</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">'n'</span><span class="token punctuation">,</span> closingKey<span class="token punctuation">,</span> <span class="token string">':close&lt;CR>'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'silent'</span><span class="token punctuation">:</span> v<span class="token punctuation">:</span>true<span class="token punctuation">,</span> <span class="token string">'nowait'</span><span class="token punctuation">:</span> v<span class="token punctuation">:</span>true<span class="token punctuation">,</span> <span class="token string">'noremap'</span><span class="token punctuation">:</span> v<span class="token punctuation">:</span>true<span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token keyword">endfor</span><br><br>    <span class="token comment">" Create the floating window</span><br>    <span class="token keyword">let</span> ui <span class="token operator">=</span> <span class="token function">nvim_list_uis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><br>    <span class="token keyword">let</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'relative'</span><span class="token punctuation">:</span> <span class="token string">'editor'</span><span class="token punctuation">,</span><br>                \ <span class="token string">'width'</span><span class="token punctuation">:</span> width<span class="token punctuation">,</span><br>                \ <span class="token string">'height'</span><span class="token punctuation">:</span> height<span class="token punctuation">,</span><br>                \ <span class="token string">'col'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>ui<span class="token operator">.</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                \ <span class="token string">'row'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>ui<span class="token operator">.</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                \ <span class="token string">'anchor'</span><span class="token punctuation">:</span> <span class="token string">'NW'</span><span class="token punctuation">,</span><br>                \ <span class="token string">'style'</span><span class="token punctuation">:</span> <span class="token string">'minimal'</span><span class="token punctuation">,</span><br>                \ <span class="token punctuation">}</span><br>    <span class="token keyword">let</span> <span class="token keyword">win</span> <span class="token operator">=</span> <span class="token function">nvim_open_win</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span><br><br>    <span class="token comment">" Change highlighting</span><br>    <span class="token keyword">call</span> <span class="token function">nvim_win_set_option</span><span class="token punctuation">(</span><span class="token keyword">win</span><span class="token punctuation">,</span> <span class="token string">'winhl'</span><span class="token punctuation">,</span> <span class="token string">'Normal:ErrorFloat'</span><span class="token punctuation">)</span><br><span class="token keyword">endfunction</span></code></pre>
<h3>What about creating a plugin?</h3>
<p>I thought about turning that into a plugin available on github but I decided not to go with it for two reasons:</p>
<p>Firstly this is my first time messing with these Neovim features and I'm not entirely sure that I followed every best practices with them. I don't feel like maintaining a public plugin with this code.</p>
<p>Secondly -and this is more important- I think that this kind of feature is pretty sensitive. I have seen countless new vim users following ill-advised plugins like <a href="https://github.com/takac/vim-hardtime" target="_blank" rel="noopener noreferrer">vim-hardtime</a> or <em>worse</em> <a href="https://github.com/wikitopian/hardmode" target="_blank" rel="noopener noreferrer">vim-hardmode</a>. More often than not people using them don't understand the larger picture of their issue and these plugins get in their way instead of helping them improving their workflow. I don't want to create another instance of this kind of plugin.</p>
<h3>Make it yours!</h3>
<p>I hope that this article was useful for you if you never used the floating window. There are already some plugins making use of this feature like <a href="https://www.reddit.com/r/neovim/comments/b1pctc/float_window_support_with_cocnvim/" target="_blank" rel="noopener noreferrer">coc</a> or <a href="https://github.com/junegunn/fzf.vim/issues/664" target="_blank" rel="noopener noreferrer">fzf</a> but I'm sure there are other more lightweight usages you can add to your config: Don't hesitate to share them with me!</p>


<p><a href="/">← Posts</a></p>

<hr>
<comments>
    <h3>Comments</h3>
    <a class="add-comment-btn" href="https://github.com/statox/blog-comments/issues/23#new_comment_field"  target="_blank" rel="noopener noreferrer">
        <button>Comment on Github</button>
    </a>
    <br>
</comments>

<script type="text/javascript" src="/scripts/githubComments.js"></script>
<script type="text/javascript">
    setupCommentsInPage(23);
</script>

    </div>

    <script data-goatcounter="https://statoxblog.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
