<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Comments via Github issues</title>
    <meta name="description" content="A personal blog where I write about my side projects">
    <meta name="keywords" content="statox blog">
    <meta property="og:title" content="The stuff I do">
    <meta property="og:url" content="https://www.statox.fr">
    <meta property="og:description" content="A personal blog where I write about my side projects">
    <meta property="og:type" content="website">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/open-fonts@1.1.1/fonts/inter.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css">

    
    <link rel="stylesheet" href="https://unpkg.com/prismjs@1.20.0/themes/prism-tomorrow.css">

    
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/material.css">
    <link rel="stylesheet" href="/css/minesweeper.css">
    <link rel="stylesheet" href="/css/boids.css">

</head>
<body>
    <header>
        <h1>The stuff I do</h1>
        <nav>
            <a href="/">Home</a> /
            <a href="/notes/">Notes</a> /
            <a href="/about/">About</a> /
            <a href="/social/">Social</a> /
            <a href="/feed.xml">RSS</a>
        </nav>
    </header>

    <div class="content-container">
        
<h2>Comments via Github issues</h2>
<p><a href="/">‚Üê Posts</a></p>

<p>Recently, a former coworker of mine <a href="https://25.wf/posts/2020-06-21-comments.html" target="_blank" rel="noopener noreferrer">published his solution</a> to implement comments on his personal website via Github issues. I was looking for a solution to add comments on this site and decided to <s>shamelessly copy</s> get inspiration from his post.</p>
<p>So I reformatted a bit his script, added it to my posts and realized that this solution implied to create a new issue on Github each time I created a new post. As I already use <a href="https://travis-ci.org/github/statox/blog" target="_blank" rel="noopener noreferrer">travis-ci</a> to build this website I thought it would be a nice addition to create a script to automatically create these issues for me.</p>
<p>The full source of the script is included in the site repository <a href="https://github.com/statox/blog/blob/master/tools/createIssues.js" target="_blank" rel="noopener noreferrer">here</a>, in this article I will show how I configured everything.</p>
<h3>Overview</h3>
<p>Here are the important steps to make all of this working:</p>
<ul>
<li>Create a dedicated repo <a href="https://github.com/statox/blog-comments/issues" target="_blank" rel="noopener noreferrer">blog-comments</a> which will contain the issues used to host comments;</li>
<li>Have the CI run the script each time a new article is published;</li>
<li>Give the script the ability to create new issues in the blog-comments repo;</li>
<li>Give each post a unique number representing the issue ID on Github. <a href="https://www.11ty.dev/docs/data-cascade/" target="_blank" rel="noopener noreferrer">Eleventy</a> provides a simple way to do that;</li>
<li>Make the script parsing all the published posts, listing the posts without an associated issue and creating the issues;</li>
<li>Change the posts source code to inject the comments.</li>
</ul>
<h3>Configuring travis-ci</h3>
<p>Running a script at build time with travis-ci is fairly straight forward. I added a new step in the <code>script</code> job looking like this:</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">script</span><span class="token punctuation">:</span><br>  <span class="token punctuation">-</span> npm run create<span class="token punctuation">-</span>issues <span class="token punctuation">-</span><span class="token punctuation">-</span> $BASIC_AUTH_HEADER</code></pre>
<p><code>$BASIC_AUTH_HEADER</code> is a variable which contains the string <code>github_username:github_password</code> encoded in base64. It will be used by the script to authenticate its calls to the Github API <a href="https://developer.github.com/v3/#authentication" target="_blank" rel="noopener noreferrer">using Basic Authentication</a>. Travis has <a href="https://docs.travis-ci.com/user/environment-variables/#defining-variables-in-repository-settings" target="_blank" rel="noopener noreferrer">a simple interface</a> to define this kind of variable. The double dash <code>--</code> is used to give a parameter to a npm script defined in <code>package.json</code>.</p>
<p>In <code>package.json</code> I added a new script like this:</p>
<pre class="language-json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"create-issues"</span><span class="token operator">:</span> <span class="token string">"node tools/createIssues.js"</span><br><span class="token punctuation">}</span></code></pre>
<p>Committing a simple nodejs script at <code>tools/createIssues.js</code> with only a <code>console.log()</code> confirmed this setup is working as the output of the command was shown in the travis build.</p>
<h3>Implementing the CI script</h3>
<p>Using the <a href="https://github.com/axios/axios" target="_blank" rel="noopener noreferrer">axios</a> library I can list the existing issues in the blog-comment repo:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> Axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">BASIC_AUTH_HEADER</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [0] is "node", [1] is scriptname</span><br><br><span class="token comment">/*<br> * Configure axios to always use my user agent and my Github login<br> * to authenticate to the Github API<br> */</span><br><span class="token keyword">const</span> axios <span class="token operator">=</span> Axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    baseURL<span class="token operator">:</span> <span class="token string">'https://api.github.com/'</span><span class="token punctuation">,</span><br>    headers<span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token string">'User-Agent'</span><span class="token operator">:</span> <span class="token string">'statox'</span><span class="token punctuation">,</span><br>        <span class="token string">'Authorization'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">basic </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BASIC_AUTH_HEADER</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">/*<br> * Get all of the open issues in a github repo<br> */</span><br><span class="token keyword">function</span> <span class="token function">getIssues</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><br>        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">repos/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">REPO_NAME</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/issues</span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>The other items to list are the posts. Here I needed to create a function to recursively list the files in my <code>src/posts</code> directory. These files have a header section delimited by <code>---</code> strings which are used by eleventy (the static site generator I used for this site). I created a function to parse these header and return a javascript object, that was a quick way to get things done without digging the doc but I'm sure there is a more efficient way to get this data out of eleventy. <em>(For example I could write this data directly in JS in the posts files)</em></p>
<p>With this short function I list all my posts, get their title and the ID of the issue I associated to it and exclude the posts I have not published yet.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/*<br> * Iterate through all the files found in the post folder<br> * Read them to get their data section<br> * And return a list of parsed data sections<br> */</span><br><span class="token keyword">function</span> <span class="token function">getPosts</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token function">walkSync</span><span class="token punctuation">(</span><span class="token string">'src/posts/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    async<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>files<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token punctuation">{</span>encoding<span class="token operator">:</span> <span class="token string">'utf-8'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> content</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>            <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br><br>            <span class="token comment">// Only keep the part between the two '---' lines</span><br>            <span class="token keyword">const</span> postHeader <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'---'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><br>            <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">convertPostHeader</span><span class="token punctuation">(</span>postHeader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> results</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token comment">// Only keep the published posts</span><br>        <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> results<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=></span> p<span class="token punctuation">.</span>eleventyExcludeFromCollections <span class="token operator">!==</span> <span class="token boolean">true</span> <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>A bit more logic to detect the issues which need to be created and an additional call to the Github API and here is our working script:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/*<br> * Post a new issue on github<br> */</span><br><span class="token keyword">function</span> <span class="token function">createIssue</span><span class="token punctuation">(</span><span class="token parameter">issue<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DRY_RUN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DRY RUN: creating issue'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>issue<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><br>        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">repos/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">REPO_NAME</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/issues</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <br>        <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>            title<span class="token operator">:</span> issue<span class="token punctuation">.</span>title<span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>I added a <code>DRY_RUN</code> variable which comes from how I call the script for testing purposes.</p>
<h3>Showing the comments in the posts</h3>
<p>Using the <code>commentIssueId</code> of each post and the following script allows to inject the comments in the comment section:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Script to inject comments based on github issues</span><br><span class="token comment">// Shamelessly taken from https://25.wf/posts/2020-06-21-comments.html</span><br><span class="token keyword">function</span> <span class="token function">domReady</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token string">'interactive'</span> <span class="token operator">||</span> document<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token string">'complete'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getComments</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>        method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span><br>        mode<span class="token operator">:</span> <span class="token string">'cors'</span><span class="token punctuation">,</span><br>        cache<span class="token operator">:</span> <span class="token string">'no-cache'</span><span class="token punctuation">,</span><br>        headers<span class="token operator">:</span> <span class="token punctuation">{</span> Accept<span class="token operator">:</span> <span class="token string">'application/vnd.github.v3.html+json'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token function">domReady</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> apiUrl <span class="token operator">=</span> <span class="token string">'https://api.github.com/repos/statox/blog-comments/issues/10/comments'</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> <span class="token function-variable function">appendComments</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">comments</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> commentSection <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'comments'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>comments <span class="token operator">||</span> <span class="token operator">!</span>comments<span class="token punctuation">.</span>forEach <span class="token operator">||</span> comments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            commentSection<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> <span class="token string">'&lt;p>No comments yet.&lt;/p>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">return</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        comments<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">comment</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            commentSection<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><br>                <span class="token string">'beforeend'</span><span class="token punctuation">,</span><br>                <span class="token string">'&lt;div class="comment">'</span> <span class="token operator">+</span><br>                <span class="token string">'‚Ä¢ &lt;a href="'</span> <span class="token operator">+</span> comment<span class="token punctuation">.</span>user<span class="token punctuation">.</span>html_url <span class="token operator">+</span> <span class="token string">'" target="_blank">'</span> <span class="token operator">+</span> comment<span class="token punctuation">.</span>user<span class="token punctuation">.</span>login <span class="token operator">+</span> <span class="token string">'&lt;/a>'</span> <span class="token operator">+</span><br>                <span class="token string">' on'</span> <span class="token operator">+</span><br>                <span class="token string">' &lt;a href="'</span> <span class="token operator">+</span> comment<span class="token punctuation">.</span>html_url <span class="token operator">+</span> <span class="token string">'" target="_blank">'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>comment<span class="token punctuation">.</span>created_at<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&lt;/a>'</span> <span class="token operator">+</span><br>                comment<span class="token punctuation">.</span>body_html <span class="token operator">+</span><br>                <span class="token string">'&lt;/div>'</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token function">getComments</span><span class="token punctuation">(</span>apiUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>appendComments<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3>So much time saved!</h3>
<p>And that's how I came up with a system which makes me save about one minute every time I publish a new post (which doesn't happen more than a few time a month at best)! It took me about 4 hours to get the whole thing working so according to this famous XKCD... that might have been a bit of a waste of time, but it was fun to do! üòÖ</p>
<p><img src="https://imgs.xkcd.com/comics/is_it_worth_the_time.png" alt="XKCD is it worth the time"></p>
<p>I still have a few more things I want to implement:</p>
<ul>
<li>Improving how I handle the data coming from the posts to avoid parsing it myself</li>
<li>Adding a check to make sure my posts all have unique and sequential issues ID</li>
<li>Adding a mechanism to update the title of the issues if the title of the post change</li>
<li>Adding a content to the OP of the issue to have a link to the article</li>
</ul>
<p>But given the previous XKCD graph I'll see when I have time for that and if I really have a need for it too.</p>


<p><a href="/">‚Üê Posts</a></p>

<hr>
<comments>
    <h3>Comments</h3>
    <a class="add-comment" href="https://github.com/statox/blog-comments/issues/10#new_comment_field"  target="_blank" rel="noopener noreferrer">
        <button>Comment on Github</button>
    </a>
    <br>
</comments>

<script type="text/javascript">


function domReady(fn) {
    document.addEventListener('DOMContentLoaded', fn);
    if (document.readyState === 'interactive' || document.readyState === 'complete') {
        fn();
    }
}

async function getComments(url = '') {
    const response = await fetch(url, {
        method: 'GET',
        mode: 'cors',
        cache: 'no-cache',
        headers: { Accept: 'application/vnd.github.v3.html+json' },
    });
    return response.json();
}

domReady(() => {
    const apiUrl = 'https://api.github.com/repos/statox/blog-comments/issues/10/comments';
    const appendComments = function (comments) {
        const commentSection = document.querySelector('comments');
        if (!comments || !comments.forEach || comments.length === 0) {
            commentSection.insertAdjacentHTML('beforeend', '<p>No comments yet.</p>');
            return;
        }
        comments.forEach(function (comment) {
            commentSection.insertAdjacentHTML(
                'beforeend',
                '<div class="comment">' +
                '‚Ä¢ <a href="' + comment.user.html_url + '" target="_blank">' + comment.user.login + '</a>' +
                ' on' +
                ' <a href="' + comment.html_url + '" target="_blank">' + new Date(comment.created_at).toUTCString() + '</a>' +
                comment.body_html +
                '</div>',
            );
        });
    };
    getComments(apiUrl).then(appendComments);
});
</script>

    </div>

    <script data-goatcounter="https://statoxblog.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    <script async defer src="https://api.newcss.net/latest.js"></script>
    <noscript><img src="https://api.newcss.net/noscript.gif" alt=""></noscript>
</body>
</html>
