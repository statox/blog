<!doctype html><html lang="en"><title>Synchronized colorscheme toggling for WezTerm and Neovim - The stuff I do</title><meta name="description" content="A personal blog where I write about my side projects"/><meta name="robots" content="index,follow"/><meta name="author" content="[object Object]"/><link rel="canonical" href="https://www.statox.fr/posts/2025/12/wezterm_neovim_synced_colorscheme/"/><meta property="og:title" content="Synchronized colorscheme toggling for WezTerm and Neovim - The stuff I do"/><meta property="og:type" content="article"/><meta property="og:url" content="https://www.statox.fr/posts/2025/12/wezterm_neovim_synced_colorscheme/"/><meta property="og:description" content="A personal blog where I write about my side projects"/><meta name="twitter:card" content="summary"/><meta name="twitter:url" content="https://www.statox.fr/posts/2025/12/wezterm_neovim_synced_colorscheme/"/><meta name="twitter:title" content="Synchronized colorscheme toggling for WezTerm and Neovim - The stuff I do"/><meta name="twitter:description" content="A personal blog where I write about my side projects"/><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Synchronized colorscheme toggling for WezTerm and Neovim</title><meta name="description" content="A personal blog where I write about my side projects"/><meta name="keywords" content="statox blog"/><meta name="generator" content="Eleventy"/><meta property="og:title" content="The stuff I do"/><meta property="og:url" content="https://www.statox.fr"/><meta property="og:description" content="A personal blog where I write about my side projects"/><meta property="og:type" content="website"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5"/><script>const bigScreenQuery=window.matchMedia("(max-width: 600px)");let bigScreen=!bigScreenQuery.matches;function navbarNavigate(e){var t=document.getElementById("header-navbar");(bigScreen||t.className.includes("responsive"))&&(document.location.pathname=e)}function navbarToggle(){var e=document.getElementById("header-navbar");"topnav"===e.className?e.className+=" responsive":e.className="topnav"}function toggleDarkTheme(){var e,t,n="1"===getComputedStyle(document.documentElement).getPropertyValue("--is-light-theme");const o=n?"-d":"-l";for({current:e,target:t}of["--nc-tx-1","--nc-tx-2","--nc-tx-3","--nc-bg-0","--nc-bg-1","--nc-bg-2","--nc-bg-3","--nc-lk-1","--nc-lk-2","--nc-lk-tx","--nc-ac-1","--nc-ac-tx"].map(e=>({current:e,target:e.slice(0,4)+o+e.slice(4)}))){var a=getComputedStyle(document.documentElement).getPropertyValue(t);document.documentElement.style.setProperty(e,a)}document.documentElement.style.setProperty("--is-light-theme",n?"0":"1"),writeLightThemeCookie(n?"0":"1")}function domReady(e){document.addEventListener("DOMContentLoaded",e),"interactive"!==document.readyState&&"complete"!==document.readyState||e()}function readLightThemeCookie(){return localStorage.getItem("lighttheme")}function writeLightThemeCookie(e){if("0"!==e&&"1"!==e)throw new Error("Invalid value for cookie lighttheme",e);localStorage.setItem("lighttheme",e)}bigScreenQuery.addListener(e=>bigScreen=!e.matches),domReady(()=>{var e=readLightThemeCookie();e&&getComputedStyle(document.documentElement).getPropertyValue("--is-light-theme")!==e&&toggleDarkTheme()})</script><style>/*!
 * new.css framework forked from https://github.com/xz/new.css
 */:root{--nc-font-sans:"Inter",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--nc-font-mono:Consolas,monaco,"Ubuntu Mono","Liberation Mono","Courier New",Courier,monospace;--is-light-theme:1;--nc-l-tx-1:#000000;--nc-l-tx-2:#1a1a1a;--nc-l-tx-3:#6d7169;--nc-l-bg-0:#cecece;--nc-l-bg-1:#ffffff;--nc-l-bg-2:#f6f8fa;--nc-l-bg-3:#e5e7eb;--nc-l-lk-1:#0070f3;--nc-l-lk-2:#0366d6;--nc-l-lk-tx:#ffffff;--nc-l-ac-1:#79ffe1;--nc-l-ac-tx:#0c4047;--nc-d-tx-1:#ffffff;--nc-d-tx-2:#eeeeee;--nc-d-tx-3:#8a8d87;--nc-d-bg-0:#13191c;--nc-d-bg-1:#000000;--nc-d-bg-2:#111111;--nc-d-bg-3:#222222;--nc-d-lk-1:#3291ff;--nc-d-lk-2:#0070f3;--nc-d-lk-tx:#ffffff;--nc-d-ac-1:#7928ca;--nc-d-ac-tx:#ffffff;--nc-tx-1:var(--nc-l-tx-1);--nc-tx-2:var(--nc-l-tx-2);--nc-tx-3:var(--nc-l-tx-3);--nc-bg-0:var(--nc-l-bg-0);--nc-bg-1:var(--nc-l-bg-1);--nc-bg-2:var(--nc-l-bg-2);--nc-bg-3:var(--nc-l-bg-3);--nc-lk-1:var(--nc-l-lk-1);--nc-lk-2:var(--nc-l-lk-2);--nc-lk-tx:var(--nc-l-lk-tx);--nc-ac-1:var(--nc-l-ac-1);--nc-ac-tx:var(--nc-l-ac-tx)}@media (prefers-color-scheme:dark){:root{--is-light-theme:0;--nc-tx-1:var(--nc-d-tx-1);--nc-tx-2:var(--nc-d-tx-2);--nc-bg-0:var(--nc-d-bg-0);--nc-bg-1:var(--nc-d-bg-1);--nc-bg-2:var(--nc-d-bg-2);--nc-bg-3:var(--nc-d-bg-3);--nc-lk-1:var(--nc-d-lk-1);--nc-lk-2:var(--nc-d-lk-2);--nc-lk-tx:var(--nc-d-lk-tx);--nc-ac-1:var(--nc-d-ac-1);--nc-ac-tx:var(--nc-d-ac-tx)}}*{margin:0;padding:0}address,area,article,aside,audio,blockquote,datalist,details,dl,fieldset,figure,form,iframe,img,input,meter,nav,ol,optgroup,option,output,p,pre,progress,ruby,section,table,textarea,ul,video{margin-bottom:1rem}button,html,input,select{font-family:var(--nc-font-sans)}body{margin:0 auto;max-width:750px;padding:2rem;border-radius:6px;overflow-x:hidden;word-break:break-word;overflow-wrap:break-word;background:var(--nc-bg-1);color:var(--nc-tx-2);font-size:1.03rem;line-height:1.5}::selection{background:var(--nc-ac-1);color:var(--nc-ac-tx)}h1,h2,h3,h4,h5,h6{line-height:1;color:var(--nc-tx-1);padding-top:.875rem}h1,h2,h3{color:var(--nc-tx-1);padding-bottom:2px;margin-bottom:8px;border-bottom:1px solid var(--nc-bg-2)}h4,h5,h6{margin-bottom:.3rem}h1{font-size:2.25rem}h2{font-size:1.85rem}h3{font-size:1.55rem}h4{font-size:1.25rem}h5{font-size:1rem}h6{font-size:.875rem}a{color:var(--nc-lk-1)}a:hover{color:var(--nc-lk-2)}abbr:hover{cursor:help}blockquote{padding:1.5rem;background:var(--nc-bg-2);border-left:5px solid var(--nc-bg-3)}abbr{cursor:help}blockquote :last-child{padding-bottom:0;margin-bottom:0}header{background:var(--nc-bg-2);border-bottom:1px solid var(--nc-bg-3);padding:2rem 1.5rem;margin:-2rem calc(0px - (50vw - 50%)) 2rem;padding-left:calc(50vw - 50%);padding-right:calc(50vw - 50%)}header h1,header h2,header h3{padding-bottom:0;border-bottom:0}header>:first-child{margin-top:0;padding-top:0}header>:last-child{margin-bottom:0}a button,button,input[type=button],input[type=reset],input[type=submit]{font-size:1rem;display:inline-block;padding:6px 12px;text-align:center;text-decoration:none;white-space:nowrap;background:var(--nc-lk-1);color:var(--nc-lk-tx);border:0;border-radius:4px;box-sizing:border-box;cursor:pointer;color:var(--nc-lk-tx)}a button[disabled],button[disabled],input[type=button][disabled],input[type=reset][disabled],input[type=submit][disabled]{cursor:default;opacity:.5;cursor:not-allowed}.button:enabled:hover,.button:focus,button:enabled:hover,button:focus,input[type=button]:enabled:hover,input[type=button]:focus,input[type=reset]:enabled:hover,input[type=reset]:focus,input[type=submit]:enabled:hover,input[type=submit]:focus{background:var(--nc-lk-2)}code,kbd,pre,samp{font-family:var(--nc-font-mono)}code,kbd,pre,samp{background:var(--nc-bg-2);border:1px solid var(--nc-bg-3);border-radius:4px;padding:3px 6px;font-size:.9em}kbd{border-bottom:3px solid var(--nc-bg-3)}pre{padding:1rem 1.4rem;max-width:100%;overflow:auto}pre code{background:inherit;font-size:inherit;color:inherit;border:0;padding:0;margin:0}code pre{display:inline;background:inherit;font-size:inherit;color:inherit;border:0;padding:0;margin:0}details{padding:.6rem 1rem;background:var(--nc-bg-2);border:1px solid var(--nc-bg-3);border-radius:4px}summary{cursor:pointer;font-weight:700}details[open]{padding-bottom:.75rem}details[open] summary{margin-bottom:6px}details[open]>:last-child{margin-bottom:0}dt{font-weight:700}dd::before{content:"‚Üí "}hr{border:0;border-bottom:1px solid var(--nc-bg-3);margin:1rem auto}fieldset{margin-top:1rem;padding:2rem;border:1px solid var(--nc-bg-3);border-radius:4px}legend{padding:auto .5rem}table{border-collapse:collapse;width:100%}td,th{text-align:left;padding:.5rem}th{font-weight:400;border-bottom:1px solid var(--nc-tx-1)}table caption{font-weight:700;margin-bottom:.5rem}textarea{max-width:100%}ol,ul{padding-left:2rem}li{margin-top:.4rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}mark{padding:3px 6px;background:var(--nc-ac-1);color:var(--nc-ac-tx)}input,select,textarea{padding:6px 12px;margin-bottom:.5rem;background:var(--nc-bg-2);color:var(--nc-tx-2);border:1px solid var(--nc-bg-3);border-radius:4px;box-shadow:none;box-sizing:border-box}img{max-width:100%}/*!
 * prism.js tomorrow night eighties for javascript, coffeescript, css and html
 * based on https://github.com/chriskempson/tomorrow-theme
 * Author: Rose Pritchard
 */code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.formatted-tag{font-family:var(--nc-font-mono);opacity:.6}.not-found{text-align:center}#not-found-canvas{z-index:-1}a{text-decoration:none}pre{max-height:50rem}img{display:block;margin-left:auto;margin-right:auto}ul{list-style-type:circle}.header-anchor{font-size:small}.hidden{display:none}/*!
 * Inspired by material theme https://www.material-theme.com/docs/reference/color-palette/
 */:root{--is-light-theme:1;--nc-l-tx-1:#546e7a;--nc-l-tx-2:#161d21;--nc-l-tx-3:#6d7169;--nc-l-bg-1:#f4f4f4;--nc-l-bg-2:#eae8e8;--nc-l-bg-3:#fafafa;--nc-l-lk-1:#176166;--nc-l-lk-2:#528aff;--nc-l-lk-tx:#f3f4f5;--nc-l-ac-1:#91b859;--nc-l-ac-tx:#fafafa;--nc-d-tx-1:#ffffff;--nc-d-tx-2:#b7b7b7;--nc-d-tx-3:#8a8d87;--nc-d-bg-1:#1e272c;--nc-d-bg-2:#161d21;--nc-d-bg-3:#263238;--nc-d-lk-1:#5e92ff;--nc-d-lk-2:#99b2e8;--nc-d-lk-tx:#2e3c43;--nc-d-ac-1:#c3e88d;--nc-d-ac-tx:#263238}@media (prefers-color-scheme:dark){:root{--is-light-theme:0;--nc-tx-1:var(--nc-d-tx-1);--nc-tx-2:var(--nc-d-tx-2);--nc-tx-3:var(--nc-d-tx-3);--nc-bg-1:var(--nc-d-bg-1);--nc-bg-2:var(--nc-d-bg-2);--nc-bg-3:var(--nc-d-bg-3);--nc-lk-1:var(--nc-d-lk-1);--nc-lk-2:var(--nc-d-lk-2);--nc-lk-tx:var(--nc-d-lk-tx);--nc-ac-1:var(--nc-d-ac-1);--nc-ac-tx:var(--nc-d-ac-tx)}}.nav-link{text-decoration:none}.nav-link.active{color:var(--nc-lk-2)}.hamburger{width:20px;height:2px;box-shadow:inset 0 0 0 32px,0 -6px,0 6px;margin:16px 7px;display:block}.topnav .icon{display:none}@media screen and (max-width:600px){.topnav span.nav-item:not(.active){display:none}.topnav span.icon{float:right;display:block;right:0;top:0;color:var(--nc-lk-1)}.topnav .nav-separator{display:none}.topnav.responsive{position:relative}.topnav.responsive span.icon{position:absolute;right:0;top:0;color:var(--nc-lk-2)}.topnav.responsive span{float:none;display:block;text-align:left}.topnav.responsive span.nav-item:not(.active){display:block}}.comment{--comment-bg:#e3efee;--comment-d-bg:#2a4765;margin-top:20px;padding:5px}.add-comment-btn{float:right}.comment-header{background:var(--comment-bg);padding-right:100px;padding-left:10px;border-top-left-radius:10px;border-top-right-radius:10px;padding:5px}.comment-content{border:2px solid var(--comment-bg);border-bottom-left-radius:10px;border-bottom-right-radius:10px}.comment-text{padding:10px}.comment-reactions{border-top:2px solid var(--comment-bg);padding:5px}.comment-reaction-item{padding-right:10px;padding-left:10px;border-right:2px solid var(--comment-bg)}@media (prefers-color-scheme:dark){.comment{--comment-bg:var(--comment-d-bg)}}kbd{--black-800:#242729;--white:#fff;--black-075:#e4e6e8;--black-300:#9fa6ad;--s-prose-line-height:1.5;--ff-sans:Arial,"Helvetica Neue",Helvetica,sans-serif}@media (prefers-color-scheme:dark){kbd{--black-800:#e7e8eb;--white:#2d2d2d;--black-075:#404345;--black-300:#7d848d}}kbd{display:inline-block;margin:0 .1em;padding:.1em .6em;font-family:var(--nc-font-sans);font-size:11px;line-height:var(--s-prose-line-height);color:var(--black-800);text-shadow:0 1px 0 var(--white);background-color:var(--black-075);border:1px solid var(--black-300);border-radius:3px;box-shadow:0 1px 1px rgba(12,13,14,.15),inset 0 1px 0 0 #fff;overflow-wrap:break-word}.top-link{transition:all .25s ease-in-out;position:fixed;bottom:0;left:10;display:inline-flex;cursor:pointer;align-items:center;justify-content:center;margin:0 3em 3em 0;border-radius:50%;padding:.25em;width:40px;height:40px;background-color:var(--nc-bg-2)}.top-link.show{visibility:visible;opacity:1}.top-link.hide{visibility:hidden;opacity:0}.top-link svg{fill:var(--nc-lk-1);width:24px;height:12px}.top-link:hover{background-color:var(--nc-bg-0)}.top-link:hover svg{fill:var(--nc-lk-2)}.screen-reader-text{position:absolute;clip-path:inset(50%);margin:-1px;border:0;padding:0;width:1px;height:1px;overflow:hidden;word-wrap:normal!important;clip:rect(1px,1px,1px,1px)}.screen-reader-text:focus{display:block;top:5px;left:5px;z-index:100000;clip-path:none;background-color:#eee;padding:15px 23px 14px;width:auto;height:auto;text-decoration:none;line-height:normal;color:#444;font-size:1em;clip:auto!important}.disable-scrollbars::-webkit-scrollbar{background:0 0;width:0}.disable-scrollbars{scrollbar-width:none;-ms-overflow-style:none}.pull-right{float:right}.post-subheader{font-style:italic;color:var(--nc-tx-3)}.post-date{font-family:var(--nc-font-mono)}ul.post-list{list-style-type:none;padding-left:0}@media screen and (max-width:600px){.post-date{display:none}ul.post-list{list-style-type:disc;padding-left:0}}.post-date.no-date{display:none}ul.post-list.no-date{list-style-type:disc;padding-left:2rem}</style></head><body><header><h1>The stuff I do</h1><nav class="topnav" id="header-navbar" onclick="navbarToggle()"><span class="nav-item"><a class="nav-link" href="#" onclick='navbarNavigate("/")' data-goatcounter-click="navbar-Home" data-goatcounter-referrer="/posts/2025/12/wezterm_neovim_synced_colorscheme/">Home</a> <i class="nav-separator">‚ô¢</i> </span><span class="nav-item"><a class="nav-link" href="#" onclick='navbarNavigate("/posts/")' data-goatcounter-click="navbar-Posts" data-goatcounter-referrer="/posts/2025/12/wezterm_neovim_synced_colorscheme/">Posts</a> <i class="nav-separator">‚ô¢</i> </span><span class="nav-item"><a class="nav-link" href="#" onclick='navbarNavigate("/projects/")' data-goatcounter-click="navbar-Projects" data-goatcounter-referrer="/posts/2025/12/wezterm_neovim_synced_colorscheme/">Projects</a> <i class="nav-separator">‚ô¢</i> </span><span class="nav-item"><a class="nav-link" href="#" onclick='navbarNavigate("/apps/")' data-goatcounter-click="navbar-Apps" data-goatcounter-referrer="/posts/2025/12/wezterm_neovim_synced_colorscheme/">Apps</a> <i class="nav-separator">‚ô¢</i> </span><span class="nav-item"><a class="nav-link" href="#" onclick='navbarNavigate("/music/")' data-goatcounter-click="navbar-Music" data-goatcounter-referrer="/posts/2025/12/wezterm_neovim_synced_colorscheme/">Music</a> <i class="nav-separator">‚ô¢</i> </span><span class="nav-item"><a class="nav-link" href="#" onclick='navbarNavigate("/about/")' data-goatcounter-click="navbar-About" data-goatcounter-referrer="/posts/2025/12/wezterm_neovim_synced_colorscheme/">About</a> <i class="nav-separator">‚ô¢</i> </span><span class="nav-item"><a class="nav-link" href="#" onclick='navbarNavigate("/ring/")' data-goatcounter-click="navbar-Ring" data-goatcounter-referrer="/posts/2025/12/wezterm_neovim_synced_colorscheme/">Ring</a> <i class="nav-separator">‚ô¢</i> </span><span class="nav-item"><a class="nav-link" href="#" onclick='navbarNavigate("/feed.xml")' data-goatcounter-click="navbar-RSS" data-goatcounter-referrer="/posts/2025/12/wezterm_neovim_synced_colorscheme/">RSS</a> <i class="nav-separator">‚ô¢</i> </span><span style="cursor:pointer" class="nav-item" onclick="toggleDarkTheme()" data-goatcounter-click="toggle-theme" data-goatcounter-referrer="/posts/2025/12/wezterm_neovim_synced_colorscheme/">‚óê</span> <span class="icon hamburger"></span></nav></header><div class="content-container"><h2>Synchronized colorscheme toggling for WezTerm and Neovim</h2><p class="post-subheader"><span id="post_date"></span> - 2568 words - <span id="commentCounter"></span> <span id="comment_word"></span></p><p><a href="/posts" data-goatcounter-click="back-to-posts" data-goatcounter-referrer="/posts/2025/12/wezterm_neovim_synced_colorscheme/">‚Üê Posts</a></p><p><strong>TL;DR</strong>: I wanted a keybinding to toggle between light and dark colorschemes and have the change apply immediately to all my WezTerm windows and Neovim instances across multiple running processes, using pure Lua configurations. If you want to skip the context and jump straight to the implementation, <a href="#the-solution%3A-high-level-overview">go to the solution</a>.</p><hr/><p>Recently I've been reworking my terminal setup. After years of using gnome-terminal with tmux, I made the jump to <a href="https://wezfurlong.org/wezterm/" target="_blank" rel="noopener noreferrer">WezTerm</a> and replaced most of my tmux workflow with WezTerm's built-in features. The switch has been great overall, and it was the opportunity to tackle an issue which had been bothering me for a long time: I couldn't easily toggle between light and dark colorschemes and have the change apply to both my terminal and all my Neovim instances simultaneously.</p><p>In this article I'll show how I solved this problem using a shared state file and some file watching magic. If you're using WezTerm and Neovim and want synchronized colorscheme switching, this might give you some ideas for your own setup.</p><h3 id="the-context" tabindex="-1">The context <a class="header-anchor" href="#the-context">üîó</a></h3><p>For colorschemes I've been using <a href="https://github.com/EdenEast/nightfox.nvim" target="_blank" rel="noopener noreferrer">nightfox.nvim</a>, specifically the <code>nightfox</code> variant for dark mode and <code>dayfox</code> for light mode. During the day I prefer a light theme, but when evening comes I want to switch to something easier on the eyes. One advantage of WezTerm is that by default it bundles a lot of colorschemes including the nightfox ones I was already using in Neovim.</p><p>I'm not using system-wide light/dark theme settings because I haven't integrated that well with my i3 window manager setup yet. That might change in the future, but for now I wanted something simpler that I could control directly from my terminal.</p><p>Here's what makes this tricky: I often have multiple WezTerm instances running at the same time. One for my frontend repo, another for backend, maybe a third for some side project. Each instance has several windows (the WezTerm name for tmux &quot;tabs&quot;), and potentially multiple Neovim instances spread across different windows. When I toggle between light and dark mode, I want all of them to update immediately.</p><h3 id="the-problem" tabindex="-1">The problem <a class="header-anchor" href="#the-problem">üîó</a></h3><p>What I needed was:</p><ul><li>A keybinding in WezTerm to toggle between light and dark themes</li><li>All WezTerm windows (across multiple instances) to update their colorscheme</li><li>All Neovim instances to update their colorscheme automatically</li><li>Everything to happen immediately, without manual intervention</li><li>A pure Lua implementation without relying on shell commands for file operations</li></ul><p>This seemed like it should be a common use case, but I couldn't find an existing solution that did exactly what I wanted.</p><h3 id="what-others-have-tried" tabindex="-1">What others have tried <a class="header-anchor" href="#what-others-have-tried">üîó</a></h3><p>I did some research and found that other people have faced similar issues, but the solutions weren't quite right for my needs:</p><p><a href="https://www.reddit.com/r/neovim/comments/19bb3e1/consistent_neovimwezterm_colorscheme/" target="_blank" rel="noopener noreferrer">This Reddit thread</a> describes using a file to store the colorscheme name, but Neovim is responsible for changing the file. I wanted WezTerm to be in control. Also, their solution requires manually restarting WezTerm or reloading its config to apply changes.</p><p><a href="https://github.com/wezterm/wezterm/discussions/3426#discussioncomment-9724438" target="_blank" rel="noopener noreferrer">This GitHub discussion</a> has WezTerm updating the file, which is closer to what I wanted, but Neovim needs to be manually restarted to pick up the new colorscheme. Also, it relies on spawning a subprocess to run <code>echo</code> to write to the file. I wanted a pure Lua solution.</p><p><a href="https://blog.tymek.dev/automatically-changing-theme-in-the-terminal/" target="_blank" rel="noopener noreferrer">This blog post</a> has an interesting approach where Neovim changes are based on the <a href="https://neovim.io/doc/user/autocmd.html#FocusGained" target="_blank" rel="noopener noreferrer"><code>FocusGained</code></a> autocommand event. The problem is that you need to remove and add focus to potentially all running Neovim instances for this to work, which is not ideal when you have many of them.</p><p>None of these solutions gave me the immediate, automatic synchronization I was looking for, so I decided to build my own.</p><h3 id="my-initial-attempts" tabindex="-1">My initial attempts <a class="header-anchor" href="#my-initial-attempts">üîó</a></h3><p>Before settling on the file-based approach, I tried a couple of other ideas that didn't quite work out:</p><p>First, I experimented with using an environment variable to share the colorscheme state between WezTerm and Neovim. The problem was timing and environment variables scope: I needed to set the environment variable before WezTerm reads its configuration, and then update it when toggling. I couldn't find a convenient way to make this work, especially since environment variables set in a running WezTerm instance wouldn't propagate to other already-running instances.</p><p>I also tried using WezTerm's <a href="https://wezterm.org/config/lua/window/set_config_overrides.html" target="_blank" rel="noopener noreferrer"><code>window:set_config_overrides()</code></a> API, which allows changing configuration for a specific window at runtime. This seemed promising at first, but the overrides only applied to the single window where the keybinding was pressed, not to all WezTerm instances. This meant I'd still need some way to communicate the colorscheme change to other instances, bringing me back to square one.</p><p>These experiments led me to realize that what I needed was a simple shared state mechanism that all instances could monitor independently. That's when I landed on the file-based approach.</p><h3 id="the-solution%3A-high-level-overview" tabindex="-1">The solution: High level overview <a class="header-anchor" href="#the-solution%3A-high-level-overview">üîó</a></h3><p>My approach uses a simple shared state file that both applications can read and watch for changes. Here's how it works:</p><p>The setup relies on a file at <code>/tmp/colorscheme</code> which contains a single line with either <code>light</code> or <code>dark</code>.</p><p><strong>On the WezTerm side:</strong></p><ol><li>On startup, check for the file <code>/tmp/colorscheme</code>. If it doesn't exist, create it with a default value.</li><li>Read the file content and set the colorscheme accordingly (light ‚Üí dayfox, dark ‚Üí nightfox).</li><li>Provide a keybinding that reads the file, writes the opposite value, and reloads the configuration.</li></ol><p><strong>On the Neovim side:</strong></p><ol><li>On startup, read <code>/tmp/colorscheme</code> and set the appropriate colorscheme.</li><li>Set up a file watcher that monitors the file for changes.</li><li>When the file changes, automatically update the colorscheme.</li></ol><p>The advantage of this approach is that WezTerm controls the toggle and all instances of both applications react immediately because they're all watching the same file.</p><h3 id="implementing-the-wezterm-side" tabindex="-1">Implementing the WezTerm side <a class="header-anchor" href="#implementing-the-wezterm-side">üîó</a></h3><p>The WezTerm implementation is split across a few modules to keep things organized. Let's walk through the key parts.</p><h4 id="managing-colorscheme-state" tabindex="-1">Managing colorscheme state <a class="header-anchor" href="#managing-colorscheme-state">üîó</a></h4><p>First, I created a <code>colorscheme.lua</code> module to handle reading, writing, and toggling the colorscheme state:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> module <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">local</span> light_colorscheme <span class="token operator">=</span> <span class="token string">'dayfox'</span>
<span class="token keyword">local</span> dark_colorscheme <span class="token operator">=</span> <span class="token string">'nightfox'</span>

<span class="token comment">-- Shared state file: written by WezTerm, watched by Neovim</span>
<span class="token keyword">local</span> colorscheme_file_path <span class="token operator">=</span> <span class="token string">'/tmp/colorscheme'</span>

module<span class="token punctuation">.</span>default_colorscheme_mode <span class="token operator">=</span> <span class="token string">"light"</span>

<span class="token keyword">function</span> <span class="token function">create_colorscheme_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> file <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>colorscheme_file_path<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span>
    file<span class="token punctuation">:</span><span class="token function">write</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>default_colorscheme_mode<span class="token punctuation">)</span>
    file<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">read_colorscheme_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> file <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>colorscheme_file_path<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span>
    content <span class="token operator">=</span> file<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    file<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> content
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">init_colorscheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> success<span class="token punctuation">,</span> content <span class="token operator">=</span> <span class="token function">pcall</span><span class="token punctuation">(</span>read_colorscheme_file<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> success <span class="token keyword">then</span>
        wezterm<span class="token punctuation">.</span><span class="token function">log_info</span><span class="token punctuation">(</span><span class="token string">'Could not read file content, using default'</span><span class="token punctuation">)</span>
        <span class="token function">create_colorscheme_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        content <span class="token operator">=</span> module<span class="token punctuation">.</span>default_colorscheme_mode
    <span class="token keyword">end</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span>content <span class="token operator">==</span> <span class="token string">"light"</span> <span class="token keyword">or</span> content <span class="token operator">==</span> <span class="token string">"dark"</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        wezterm<span class="token punctuation">.</span><span class="token function">log_info</span><span class="token punctuation">(</span><span class="token string">'Invalid mode in file, using default'</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span>
        content <span class="token operator">=</span> module<span class="token punctuation">.</span>default_colorscheme_mode
    <span class="token keyword">end</span>

    <span class="token keyword">if</span> content <span class="token operator">==</span> <span class="token string">"light"</span> <span class="token keyword">then</span>
        <span class="token keyword">return</span> light_colorscheme
    <span class="token keyword">end</span>

    <span class="token keyword">return</span> dark_colorscheme
<span class="token keyword">end</span>
module<span class="token punctuation">.</span>init_colorscheme <span class="token operator">=</span> init_colorscheme</code></pre><p>The <code>init_colorscheme()</code> function does the heavy lifting: it reads the state file, handles cases where the file doesn't exist or contains invalid data, and returns the appropriate colorscheme name to use in the WezTerm configuration. The use of <a href="https://www.lua.org/manual/5.4/manual.html#pdf-pcall" target="_blank" rel="noopener noreferrer"><code>pcall()</code></a> (protected call) is important here: it executes the <code>read_colorscheme_file()</code> function in protected mode, catching any errors (like the file not existing) and returning a success status instead of crashing. If the call fails, we create the file with a default value.</p><p>The file operations use Lua's standard I/O library: <a href="https://www.lua.org/manual/5.4/manual.html#pdf-io.open" target="_blank" rel="noopener noreferrer"><code>io.open()</code></a> opens a file and returns a file handle, and <a href="https://www.lua.org/manual/5.4/manual.html#pdf-file:read" target="_blank" rel="noopener noreferrer"><code>file:read()</code></a> reads its content. These are pure Lua functions, no shell commands needed.</p><p>See <a href="https://github.com/statox/dotfiles/blob/98060bd83c124dd396885749ad79b831157c27d7/config/wezterm/colorscheme.lua" target="_blank" rel="noopener noreferrer">the complete <code>colorscheme.lua</code> file on GitHub</a></p><h4 id="toggling-the-colorscheme" tabindex="-1">Toggling the colorscheme <a class="header-anchor" href="#toggling-the-colorscheme">üîó</a></h4><p>The toggle function is straightforward. It reads the current mode, writes the opposite value to the file, and triggers a configuration reload:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> module<span class="token punctuation">.</span><span class="token function">toggle_colorscheme</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> pane<span class="token punctuation">,</span> config<span class="token punctuation">)</span>
    <span class="token keyword">local</span> success<span class="token punctuation">,</span> content <span class="token operator">=</span> <span class="token function">pcall</span><span class="token punctuation">(</span>read_colorscheme_file<span class="token punctuation">)</span>

    <span class="token comment">-- Lua's ternary-like expression: if content is "light", return "dark", else "light"</span>
    <span class="token keyword">local</span> new_value <span class="token operator">=</span> content <span class="token operator">==</span> <span class="token string">"light"</span> <span class="token keyword">and</span> <span class="token string">"dark"</span> <span class="token keyword">or</span> <span class="token string">"light"</span>
    <span class="token keyword">local</span> file <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>colorscheme_file_path<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> file <span class="token keyword">then</span>
        file<span class="token punctuation">:</span><span class="token function">write</span><span class="token punctuation">(</span>new_value<span class="token punctuation">)</span>
        file<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token comment">-- We reload the config which triggers setup_ui() which uses</span>
    <span class="token comment">-- init_colorscheme() to setup the colorscheme based on the file content</span>
    wezterm<span class="token punctuation">.</span><span class="token function">reload_configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">end</span></code></pre><p>When <code>wezterm.reload_configuration()</code> is called, it re-runs the entire configuration, which calls <code>init_colorscheme()</code> again and picks up the new value from the file.</p><h4 id="integrating-into-the-main-config" tabindex="-1">Integrating into the main config <a class="header-anchor" href="#integrating-into-the-main-config">üîó</a></h4><p>In my <code>ui.lua</code> module, I call <code>init_colorscheme()</code> during setup:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> colorscheme <span class="token operator">=</span> require <span class="token string">'colorscheme'</span>

<span class="token keyword">function</span> module<span class="token punctuation">.</span><span class="token function">setup_ui</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
    config<span class="token punctuation">.</span>font_size <span class="token operator">=</span> <span class="token number">11</span>
    config<span class="token punctuation">.</span>color_scheme <span class="token operator">=</span> colorscheme<span class="token punctuation">.</span><span class="token function">init_colorscheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">-- ... rest of UI configuration</span>
<span class="token keyword">end</span></code></pre><p>And in the main <code>wezterm.lua</code> file, everything comes together:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> wezterm <span class="token operator">=</span> require <span class="token string">'wezterm'</span>
<span class="token keyword">local</span> ui <span class="token operator">=</span> require <span class="token string">'ui'</span>
<span class="token keyword">local</span> mappings <span class="token operator">=</span> require <span class="token string">'mappings'</span>

<span class="token keyword">local</span> config <span class="token operator">=</span> wezterm<span class="token punctuation">.</span><span class="token function">config_builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

ui<span class="token punctuation">.</span><span class="token function">setup_ui</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
mappings<span class="token punctuation">.</span><span class="token function">setup_bindings</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>

<span class="token keyword">return</span> config</code></pre><p>See <a href="https://github.com/statox/dotfiles/blob/98060bd83c124dd396885749ad79b831157c27d7/config/wezterm/ui.lua" target="_blank" rel="noopener noreferrer">the complete <code>ui.lua</code></a> and <a href="https://github.com/statox/dotfiles/blob/98060bd83c124dd396885749ad79b831157c27d7/config/wezterm/wezterm.lua" target="_blank" rel="noopener noreferrer"><code>wezterm.lua</code> files on GitHub</a></p><h4 id="setting-up-the-keybinding" tabindex="-1">Setting up the keybinding <a class="header-anchor" href="#setting-up-the-keybinding">üîó</a></h4><p>Finally, in <code>mappings.lua</code>, I bind the toggle function to <code>&lt;leader&gt;f</code>:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> colorscheme <span class="token operator">=</span> require <span class="token string">'colorscheme'</span>

<span class="token keyword">function</span> module<span class="token punctuation">.</span><span class="token function">setup_bindings</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
    config<span class="token punctuation">.</span>leader <span class="token operator">=</span> <span class="token punctuation">{</span> key <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">,</span> mods <span class="token operator">=</span> <span class="token string">'CTRL'</span><span class="token punctuation">,</span> timeout_milliseconds <span class="token operator">=</span> <span class="token number">1000</span> <span class="token punctuation">}</span>

    config<span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">-- ... other keybindings</span>

        <span class="token comment">-- Toggle light and dark colorscheme</span>
        <span class="token punctuation">{</span>
            key <span class="token operator">=</span> <span class="token string">'f'</span><span class="token punctuation">,</span>
            mods <span class="token operator">=</span> <span class="token string">'LEADER'</span><span class="token punctuation">,</span>
            action <span class="token operator">=</span> wezterm<span class="token punctuation">.</span><span class="token function">action_callback</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> pane<span class="token punctuation">)</span>
                colorscheme<span class="token punctuation">.</span><span class="token function">toggle_colorscheme</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> pane<span class="token punctuation">)</span>
            <span class="token keyword">end</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token keyword">end</span></code></pre><p>With this setup, pressing <code>Ctrl+Space</code> (my leader key) followed by <code>f</code> will toggle between light and dark modes.</p><p>See <a href="https://github.com/statox/dotfiles/blob/98060bd83c124dd396885749ad79b831157c27d7/config/wezterm/mappings.lua#L74" target="_blank" rel="noopener noreferrer">the complete <code>mappings.lua</code> file on GitHub</a></p><p><img src="../../../../images/wezterm_neovim_synced_colorscheme/wezterm_1.gif" alt="Demonstration of pressing the keybinding in WezTerm and seeing all terminal windows update their colorscheme simultaneously from light to dark mode"/></p><center><i>This demonstration starts with an empty i3 workspace, I use <kbd>super</kbd>+<kbd>Enter</kbd> to start a new Wezterm instance which uses light mode. Then <kbd>ctrl+space</kbd>+<kbd>f</kbd> to switch to dark mode. Then I start a second Wezterm instance in a vertical split and toggle the theme for both instances a couple times more with <kbd>ctrl+space</kbd>+<kbd>f</kbd></i></center><h3 id="implementing-the-neovim-side" tabindex="-1">Implementing the Neovim side <a class="header-anchor" href="#implementing-the-neovim-side">üîó</a></h3><p>The Neovim side is simpler but requires setting up a file watcher. I put everything in a <code>colorscheme_watcher.lua</code> file.</p><h4 id="setting-up-the-file-watcher" tabindex="-1">Setting up the file watcher <a class="header-anchor" href="#setting-up-the-file-watcher">üîó</a></h4><p>I adapted some code from <a href="https://github.com/rktjmp/fwatch.nvim" target="_blank" rel="noopener noreferrer">fwatch.nvim</a> to create a lightweight file watcher. The core functionality uses Neovim's built-in <a href="https://neovim.io/doc/user/lua.html#vim.uv" target="_blank" rel="noopener noreferrer"><code>vim.loop</code></a> (the Lua bindings for the libUV library that Nvim uses for networking, filesystem, and process management):</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> uv <span class="token operator">=</span> vim<span class="token punctuation">.</span>loop

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">watch_with_function</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> on_event<span class="token punctuation">,</span> on_error<span class="token punctuation">)</span>
    <span class="token keyword">local</span> handle <span class="token operator">=</span> uv<span class="token punctuation">.</span><span class="token function">new_fs_event</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">local</span> flags <span class="token operator">=</span> <span class="token punctuation">{</span>
        watch_entry <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
        stat <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
        recursive <span class="token operator">=</span> <span class="token keyword">false</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">local</span> event_cb <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> events<span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token keyword">then</span>
            <span class="token function">on_error</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> unwatch_cb<span class="token punctuation">)</span>
        <span class="token keyword">else</span>
            <span class="token function">on_event</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> events<span class="token punctuation">,</span> unwatch_cb<span class="token punctuation">)</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    uv<span class="token punctuation">.</span><span class="token function">fs_event_start</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> path<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> event_cb<span class="token punctuation">)</span>

    <span class="token keyword">return</span> handle
<span class="token keyword">end</span></code></pre><p>The <a href="https://neovim.io/doc/user/luvref.html#uv.new_fs_event()" target="_blank" rel="noopener noreferrer"><code>vim.loop.new_fs_event()</code></a> API provides access to the operating system's file watching capabilities (inotify on Linux, FSEvents on macOS, etc.). When the file changes, our callback function gets executed.</p><h4 id="reading-and-applying-the-colorscheme" tabindex="-1">Reading and applying the colorscheme <a class="header-anchor" href="#reading-and-applying-the-colorscheme">üîó</a></h4><p>I created functions to read the state file and update the colorscheme accordingly:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">read_colorscheme_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> filepath <span class="token operator">=</span> <span class="token string">"/tmp/colorscheme"</span>

    <span class="token comment">-- Read the first line of the file</span>
    <span class="token keyword">local</span> content <span class="token operator">=</span> vim<span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function">readfile</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token string">""</span>

    <span class="token keyword">if</span> string<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">"light"</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token keyword">return</span> <span class="token string">"light"</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> string<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">"dark"</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token keyword">return</span> <span class="token string">"dark"</span>
    <span class="token keyword">end</span>

    <span class="token comment">-- Default case</span>
    <span class="token keyword">return</span> <span class="token string">"dark"</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">update_colorscheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token function">read_colorscheme_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"light"</span> <span class="token keyword">then</span>
        vim<span class="token punctuation">.</span>g<span class="token punctuation">.</span>colorsDefault <span class="token operator">=</span> <span class="token string">"dayfox"</span>
        vim<span class="token punctuation">.</span>g<span class="token punctuation">.</span>colorsDiff <span class="token operator">=</span> <span class="token string">"dayfox"</span>
    <span class="token keyword">else</span>
        vim<span class="token punctuation">.</span>g<span class="token punctuation">.</span>colorsDefault <span class="token operator">=</span> <span class="token string">"nightfox"</span>
        vim<span class="token punctuation">.</span>g<span class="token punctuation">.</span>colorsDiff <span class="token operator">=</span> <span class="token string">"nordfox"</span>
    <span class="token keyword">end</span>

    vim<span class="token punctuation">.</span><span class="token function">cmd</span><span class="token punctuation">(</span><span class="token string">"colorscheme "</span> <span class="token operator">..</span> vim<span class="token punctuation">.</span>g<span class="token punctuation">.</span>colorsDefault<span class="token punctuation">)</span>
<span class="token keyword">end</span></code></pre><p>The <a href="https://neovim.io/doc/user/lua.html#vim.cmd%28%29" target="_blank" rel="noopener noreferrer"><code>vim.cmd()</code></a> function executes a Vim command, so <code>vim.cmd(&quot;colorscheme &quot; .. vim.g.colorsDefault)</code> is equivalent to running <code>:colorscheme nightfox</code> in normal mode, with the colorscheme name taken from our variable.</p><p>I use different colorschemes for diff mode, which is why I set both <code>colorsDefault</code> and <code>colorsDiff</code> variables.</p><h4 id="putting-it-all-together" tabindex="-1">Putting it all together <a class="header-anchor" href="#putting-it-all-together">üîó</a></h4><p>Finally, I set up the colorscheme on Neovim startup and register the file watcher:</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Setup the colorscheme on startup</span>
<span class="token function">update_colorscheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">-- Update the colorscheme when WezTerm updates the colorscheme file</span>
<span class="token function">do_watch</span><span class="token punctuation">(</span><span class="token string">'/tmp/colorscheme'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    on_event <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Colorscheme file has changed.'</span><span class="token punctuation">)</span>
        <span class="token comment">-- We wrap update_colorscheme in vim.schedule because the Vimscript function</span>
        <span class="token comment">-- "readfile" must not be called in a fast event context</span>
        vim<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>update_colorscheme<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>The <a href="https://neovim.io/doc/user/lua.html#vim.schedule%28%29" target="_blank" rel="noopener noreferrer"><code>vim.schedule()</code></a> wrapper is important here. The file watcher callback runs in a &quot;fast event&quot; context where certain functions like <a href="https://neovim.io/doc/user/vimfn.html#readfile%28%29" target="_blank" rel="noopener noreferrer"><code>readfile()</code></a> are not allowed. By wrapping our update function in <code>vim.schedule()</code>, we defer its execution to a safe context.</p><p>See <a href="https://github.com/statox/dotfiles/blob/98060bd83c124dd396885749ad79b831157c27d7/config/nvim/lua/colorscheme_watcher.lua" target="_blank" rel="noopener noreferrer">the complete <code>colorscheme_watcher.lua</code> file on GitHub</a> which is then simpled <code>require</code>d <a href="https://github.com/statox/dotfiles/blob/98060bd83c124dd396885749ad79b831157c27d7/config/nvim/init.lua#L25" target="_blank" rel="noopener noreferrer">in my <code>init.lua</code> file</a>.</p><p><img src="../../../../images/wezterm_neovim_synced_colorscheme/wezterm_2.gif" alt="Screen recording showing multiple Neovim windows with different files open, and when the colorscheme file changes, all windows immediately switch from dayfox (light) to nightfox (dark) colorscheme"/></p><center><i>This demonstration starts with two WezTerm instances next to each other containing each two splits. In each instance there is a neovim instance and some command outputs (<code>git status</code> and <code>man git</code>). I use <kbd>ctrl+space</kbd>+<kbd>f</kbd> to toggle between light mode and dark mode. We can observe a slight delay before all applications colorscheme are updated.</i></center><h3 id="how-it-all-works-together" tabindex="-1">How it all works together <a class="header-anchor" href="#how-it-all-works-together">üîó</a></h3><p>Here's what happens when I press my toggle keybinding:</p><ol><li>WezTerm's toggle function reads <code>/tmp/colorscheme</code> (let's say it contains &quot;light&quot;)</li><li>It writes &quot;dark&quot; to the file</li><li>WezTerm reloads its configuration, which reads the file and sets <code>color_scheme = 'nightfox'</code></li><li>All WezTerm windows across all instances update to the dark theme</li><li>Simultaneously, all running Neovim instances detect the file change via their watchers</li><li>Each Neovim instance executes its callback, which reads the new value and runs <code>:colorscheme nightfox</code></li><li>All Neovim windows update to the dark theme</li></ol><p>The whole process happens in a fraction of a second, giving the impression that everything updates simultaneously.</p><h3 id="reflections" tabindex="-1">Reflections <a class="header-anchor" href="#reflections">üîó</a></h3><p>I'm fairly happy with how this feature turned out. The implementation is simple and after a few days of use, it's working well. When I press the keybinding in any WezTerm instance, every terminal window and every Neovim instance updates immediately. No manual intervention needed, no focus juggling, no restarts. I should mention that I've only tested this on Ubuntu with i3, so your mileage may vary on other systems.</p><p>Using a simple text file for state management might seem primitive, but it's actually good enough for this use case. Both applications can easily read and write to it, the file system provides the notification mechanism through the watchers, and there's no complex IPC to set up or maintain.</p><p>Note that for my shell I use zsh+oh-my-zsh with fairly minimal colors configuration which makes that the shell remains readable with both colorschemes. I also have a couple color configurations happening in my <a href="https://github.com/statox/dotfiles/blob/98060bd83c124dd396885749ad79b831157c27d7/gitconfig#L29" target="_blank" rel="noopener noreferrer"><code>gitconfig</code></a> but again they work well with both colorschemes.</p><h3 id="what-about-system-wide-settings%3F" tabindex="-1">What about system-wide settings? <a class="header-anchor" href="#what-about-system-wide-settings%3F">üîó</a></h3><p>For now, I'm manually controlling my colorscheme with a keybinding, but WezTerm actually has built-in support for detecting the system appearance (light or dark mode). The documentation shows how to use <a href="https://wezterm.org/config/lua/wezterm.gui/get_appearance.html" target="_blank" rel="noopener noreferrer"><code>wezterm.gui.get_appearance()</code></a> to automatically switch based on your system settings.</p><p>I think my current setup would be fairly easy to adapt for this. Instead of using a keybinding to toggle the state file, I could run a background process that watches for system appearance changes and updates <code>/tmp/colorscheme</code> accordingly. That way, when I toggle dark mode in my system settings, both WezTerm and Neovim would follow along automatically. And that would also allow my browsers and other GUI applications to be synced with the terminal.</p><p>But for now, the manual toggle is working well for me, and I haven't dedicated time to integrate with system-wide settings yet.</p><h3 id="make-it-yours" tabindex="-1">Make it yours <a class="header-anchor" href="#make-it-yours">üîó</a></h3><p>If you want to try this approach in your own setup, all the code is available in <a href="https://github.com/statox/dotfiles/tree/98060bd83c124dd396885749ad79b831157c27d7" target="_blank" rel="noopener noreferrer">my dotfiles repository</a>. The main files you'll need are:</p><ul><li><code>config/wezterm/colorscheme.lua</code>: Manages the state file and toggle logic for WezTerm</li><li><code>config/wezterm/ui.lua</code>: Integrates the colorscheme into WezTerm's configuration</li><li><code>config/wezterm/mappings.lua</code>: Sets up the keybinding</li><li><code>config/nvim/lua/colorscheme_watcher.lua</code>: Implements the file watcher and colorscheme updates for Neovim</li></ul><p>You can easily adapt this to use different colorschemes, a different state file location, or even extend it to have an external scrip change the colorscheme file based on your location and the time of the day. The file-based approach is flexible enough to support a lot of different use cases. (Though it might not be wise to re-create a complete external configuration system outside the default config)</p><p>If you implement something similar or have ideas for improvements, I'd love to hear about it in the comments!</p><p><a href="/posts" data-goatcounter-click="back-to-posts" data-goatcounter-referrer="/posts/2025/12/wezterm_neovim_synced_colorscheme/">‚Üê Posts</a></p><hr/><p></p><h3>Related posts</h3><p>Posts in the same category: <span class="formatted-tag">[terminal]</span></p><ul><li><span class="post-date">Oct 2025</span> <a class="post-link" href="/posts/2025/10/new_terminal_emulator/">Looking for a new terminal emulator on Linux</a></li></ul><hr/><comments><h3>Comments</h3><a class="add-comment-btn" href="https://github.com/statox/blog-comments/issues/41#new_comment_field" target="_blank" rel="noopener noreferrer"><button>Comment on Github</button></a><br/></comments><script>const reactionEmojis={laugh:"&#x1F600","+1":"&#x1F44D","-1":"&#x1F44E",hooray:"&#x1F389",confused:"&#x1F615",heart:"&#x2665",rocket:"&#x1F680",eyes:"&#x1F440"};function domReady(e){document.addEventListener("DOMContentLoaded",e),"interactive"!==document.readyState&&"complete"!==document.readyState||e()}function countReactions(e){const t={};return e.forEach(e=>{t[e.content]?t[e.content]++:t[e.content]=1}),t}function formatReactions(e){if(!e.length)return"";const n=countReactions(e);return Object.keys(n).reduce((e,t)=>{return e+'<span class="comment-reaction-item">'+(reactionEmojis[t]||`:${t}:`)+"&nbsp"+n[t]+"</span>"},"")}function appendComments(e){const o=document.querySelector("comments");var t=document.getElementById("commentCounter");t&&(t.innerText=e.length||0),e&&e.forEach&&0!==e.length?e.forEach(function(e){var t=formatCommentDate(new Date(e.created_at)),t=`<a href="${e.user.html_url} rel="noopener noreferrer" target="_blank">${e.user.login}</a>`+" on "+`<a href="${e.html_url}" rel="noopener noreferrer" target="_blank">${t}</a>`;let n="";n=(n=(n+='<div class="comment">')+'    <div class="comment-header">'+t+'</div>    <div class="comment-content">')+'        <div class="comment-text">'+e.body_html+"</div>",0<e.reactions.length&&(n+='        <div class="comment-reactions">'+formatReactions(e.reactions)+"</div>"),n+="    </div></div>",o.insertAdjacentHTML("beforeend",n)}):o.insertAdjacentHTML("beforeend","<p>No comments yet.</p>")}async function getComments(e){return(await fetch(`https://api.github.com/repos/statox/blog-comments/issues/${e}/comments`,{method:"GET",mode:"cors",cache:"no-cache",headers:{Accept:"application/vnd.github.v3.html+json"}})).json()}async function getReactions(e){return(await fetch(`https://api.github.com/repos/statox/blog-comments/issues/comments/${e}/reactions`,{method:"GET",mode:"cors",cache:"no-cache",headers:{Accept:"application/vnd.github.squirrel-girl-preview+json"}})).json()}function formatCommentDate(e){return e.getDate()+`/${e.getUTCMonth()+1}/`+e.getFullYear()}function setupCommentsInPage(t){domReady(async()=>{var e=await getComments(t);await Promise.all(e.map(async e=>{e.reactions=await getReactions(e.id)})),appendComments(e)})}function adaptToScreenSize(e){var t=new Date("Tue Dec 16 2025 00:00:00 GMT+0000 (Coordinated Universal Time)");let n=t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}),o="comments";e.matches&&(n=t.toLocaleDateString(void 0,{year:"numeric",month:"numeric",day:"numeric"}),o="üí¨"),document.getElementById("post_date").textContent=n,document.getElementById("comment_word").textContent=o}setupCommentsInPage(41);var x=window.matchMedia("(max-width: 500px)");adaptToScreenSize(x),x.addListener(adaptToScreenSize)</script><a class="top-link hide" href="" id="js-top"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg> <span class="screen-reader-text">Back to top</span></a><script>const scrollToTopButton=document.getElementById("js-top");let scrollTimer;const scrollFunc=()=>{var o=window.scrollY;scrollToTopButton.className=0<o?"top-link show":"top-link hide",scrollTimer&&clearTimeout(scrollTimer),scrollTimer=setTimeout(()=>{scrollToTopButton.className="top-link hide"},3e3)},scrollToTop=(window.addEventListener("scroll",scrollFunc),()=>{var o=document.documentElement.scrollTop||document.body.scrollTop;0<o&&(window.requestAnimationFrame(scrollToTop),window.scrollTo(0,o-o/2))});scrollToTopButton.onclick=function(o){o.preventDefault(),scrollToTop()}</script></div><script data-goatcounter="https://statoxblog.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/open-fonts@1.1.1/fonts/inter.min.css"/><script src="https://kit.fontawesome.com/cc32401bee.js" crossorigin="anonymous"></script></body></html>